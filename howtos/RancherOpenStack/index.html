<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Cloud-STIC">
<title>Uso de OpenStack como proveedor de infraestructura en Rancher</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Uso de OpenStack como proveedor de infraestructura en Rancher</h1>
<div class="details">
<span id="author" class="author">Cloud-STIC</span><br>
<span id="revdate">Servicio de las Tecnologías de la Información y las Comunicaciones - Universidad de Almería</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de contenidos</div>
<ul class="sectlevel1">
<li><a href="#trueresumen">Resumen</a></li>
<li><a href="#trueinstalaci-n-y-configuraci-n-inicial-de-rancher">1. Instalación y configuración inicial de Rancher</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-rancher">1.1. Instalación de Rancher</a></li>
</ul>
</li>
<li><a href="#trueactivaci-n-de-openstack-como-proveedor-de-infraestructura-de-c-mputo-para-rancher">2. Activación de OpenStack como proveedor de infraestructura de cómputo para Rancher</a>
<ul class="sectlevel2">
<li><a href="#truecreaci-n-de-la-plantilla-para-nodos">2.1. Creación de la plantilla para nodos</a></li>
<li><a href="#truecreaci-n-de-cluster-kubernetes-usando-plantillas">2.2. Creación de cluster Kubernetes usando plantillas</a></li>
</ul>
</li>
<li><a href="#trueconfiguraci-n-de-openstack-como-proveedor-de-vol-menes">3. Configuración de OpenStack como proveedor de volúmenes</a>
<ul class="sectlevel2">
<li><a href="#truevalores-de-configuraci-n-del-archivo-yaml">3.1. Valores de configuración del archivo YAML</a></li>
</ul>
</li>
<li><a href="#truecreaci-n-de-vol-menes-cinder-en-clusters-kubernetes">4. Creación de volúmenes Cinder en clusters Kubernetes</a>
<ul class="sectlevel3">
<li><a href="#truecreaci-n-de-una-clase-de-almacenamiento-para-cinder">4.1. Creación de una clase de almacenamiento para Cinder</a></li>
<li><a href="#truecreaci-n-de-un-volumen-persistente">4.2. Creación de un volumen persistente</a></li>
<li><a href="#truecreaci-n-de-una-petici-n-de-volumen-persistente">4.3. Creación de una petición de volumen persistente</a></li>
<li><a href="#truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml">4.4. Creación de una petición de volumen mediante manifiesto YAML</a></li>
</ul>
</li>
<li><a href="#truecreaci-n-de-vol-menes-nfs-con-openstack-manila-en-clusters-kubernetes">5. Creación de volúmenes NFS con Openstack Manila en clusters Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#truecreaci-n-de-un-volumen-persistente-2">5.1. Creación de un volumen persistente</a></li>
<li><a href="#truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml-2">5.2. Creación de una petición de volumen mediante manifiesto YAML</a></li>
</ul>
</li>
<li><a href="#trueconclusiones">6. Conclusiones</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/logocloudstic.png" alt="logocloudstic.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueresumen"><a class="anchor" href="#trueresumen"></a>Resumen</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rancher.com/">Rancher</a> es un proyecto open-source que nos permite administrar clusters de <a href="https://kubernetes.io/">Kubernetes</a>. Su gran ventaja es que permite gestionar desde un único lugar clusters Kubernetes alojados bien en alguno de los proveedores de Kubernetes más populares, como Google Container Engine, Amazon EKS o Azure Kubernetes Service, o bien, en proveedores de infraestructura, como Amazon EC2, Microsoft Azure, Digital Ocean, RackSpace, OpenStack, SoftLayer, vSphere, entre otros.</p>
</div>
<div class="paragraph">
<p>En este tutorial veremos por un lado, cómo crear un cluster Kubernetes usando OpenStack como proveedor de infaestructura para el máster y los nodos worker. Por otro lado, veremos cómo usar OpenStack Cinder para propocionar almacenamiento persistente a clusters Kubernetes creados sobre OpenStack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstalaci-n-y-configuraci-n-inicial-de-rancher"><a class="anchor" href="#trueinstalaci-n-y-configuraci-n-inicial-de-rancher"></a>1. Instalación y configuración inicial de Rancher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rancher es una plataforma de gestión de distribuciones de Kubernetes en proveedores diferentes (Google, Amazon, Microsoft, RackSpace, OpenStack, vSphere, &#8230;&#8203;). Rancher permite la creación y administración centralizada de clusters de Kubernetes independientemente del proveedor elegido. Además, permite usar catálogos de aplicaciones a partir de repositorios de <a href="https://github.com/bitnami/charts">charts Helm</a> para desplegarlas de forma sencilla.</p>
</div>
<div class="paragraph">
<p>A continuación veremos cómo realizar una instalación básica de Rancher y cómo configurarlo para que Rancher pueda crear clusters de Kubernetes usando OpenStack como IaaS.</p>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-rancher"><a class="anchor" href="#trueinstalaci-n-de-rancher"></a>1.1. Instalación de Rancher</h3>
<div class="paragraph">
<p>Siguiendo la <a href="https://rancher.com/quick-start/">Guía rápida de instalación de Rancher</a>, a partir de una máquina Ubuntu configurada con Docker ejecutaremos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">sudo docker run -d \
    --volumes-from rancher-data \ <i class="conum" data-value="1"></i><b>(1)</b>
    --restart=unless-stopped \
    -p 80:80 -p 443:443 \
    rancher/rancher:latest`</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Almacenamos los datos de Rancher como un volumen fuera del contenedor.</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Instalación de Rancher usando certificados SSL</div>
<div class="paragraph">
<p>Si disponemos de certificados SSL podemos iniciar Rancher indicándole que use los certificados. En el caso de Rancher-STIC, hemos colocado los certificados en un directorio que pasamos como volumen a Rancher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">docker run -d \
    --restart=unless-stopped \
    -p 80:80 -p 443:443 \
    -v /home/ubuntu/rancherdata:/var/lib/rancher \ <i class="conum" data-value="1"></i><b>(1)</b>
    -v /home/ubuntu/certificados/star_stic_ual_es.crt:/etc/rancher/ssl/cert.pem \ <i class="conum" data-value="2"></i><b>(2)</b>
    -v /home/ubuntu/certificados/star_stic_ual_es.key:/etc/rancher/ssl/key.pem \ <i class="conum" data-value="3"></i><b>(3)</b>
    -v /home/ubuntu/certificados/DigiCertCA.crt:/etc/rancher/ssl/cacerts.pem \ <i class="conum" data-value="4"></i><b>(4)</b>
    rancher/rancher:latest</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Volumen para almacenamiento de datos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Concatenación del certificado de Rancher con el de la entidad certificadora (Rancher usa <a href="https://knowledge.digicert.com/solution/SO16297.html">cadenas de certificados</a>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Clave privada</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Entiidad certificadora</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si no se va a usar la entidad certificadora, usar este script</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">docker run -d \
    --restart=unless-stopped \
    -p 80:80 -p 443:443 \
    -v /home/ubuntu/rancherdata:/var/lib/rancher \ <i class="conum" data-value="1"></i><b>(1)</b>
    -v /home/ubuntu/certificados/star_stic_ual_es.crt:/etc/rancher/ssl/cert.pem \ <i class="conum" data-value="2"></i><b>(2)</b>
    -v /home/ubuntu/certificados/star_stic_ual_es.key:/etc/rancher/ssl/key.pem \ <i class="conum" data-value="3"></i><b>(3)</b>
    rancher/rancher:latest \
    --no-cacerts <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Volumen para almacenamiento de datos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Concatenación del certificado de Rancher con el de la entidad certificadora (Rancher usa <a href="https://knowledge.digicert.com/solution/SO16297.html">cadenas de certificados</a>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Clave privada</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Desactivación de los certificados predeterminados generados por Rancher</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueactivaci-n-de-openstack-como-proveedor-de-infraestructura-de-c-mputo-para-rancher"><a class="anchor" href="#trueactivaci-n-de-openstack-como-proveedor-de-infraestructura-de-c-mputo-para-rancher"></a>2. Activación de OpenStack como proveedor de infraestructura de cómputo para Rancher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De forma predeterminada, Rancher ofrece los siguientes proveedores para la creación de clusters Kubernetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Proveedores de Kubernetes: Google Container Engine, Amazon EKS y Azure Kubernetes Service</p>
</li>
<li>
<p>Proveedores de infraestructura: Amazon EC2, Microsoft Azure, Digital Ocean, y vSphere.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sin embargo, otros proveedores de infraestructura como RackSpace, <a href="https://www.openstack.org/">OpenStack</a>, SoftLayer, entre otros, no están disponibles de forma predeterminada.</p>
</div>
<div class="paragraph">
<p>Para activar OpenStack como nuevo proveedor de infraestructura (esto es aplicable a cualquier otro proveedor, p.e. RackSpace), seleccionaremos <code>Global</code> como cluster y a continuación <code>Node Drivers</code> en la barra de menú. Esta acción muestra todos los proveedores que podemos añadir para la creación de los nodos de los clusters Kubernetes que creemos.</p>
</div>
<div class="paragraph">
<p>La figura siguiente ilustra la lista de proveedores y cómo se activa OpenStack como proveedor de infraestructura.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-drivers.png" alt="node drivers.png">
</div>
</div>
<div class="paragraph">
<p>Al pulsar <code>Activate</code> sobre OpenStack quedará activado OpenStack como proveedor de infraestructura, tal y como ilustra la figura siguiente:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/openstack-active.png" alt="openstack active.png">
</div>
</div>
<div class="paragraph">
<p>Sin embago, esto no es suficiente. A continuación, hay que definir la plantilla con la que se crearán en OpenStack los nodos del cluster Kubernetes (master y workers)</p>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-la-plantilla-para-nodos"><a class="anchor" href="#truecreaci-n-de-la-plantilla-para-nodos"></a>2.1. Creación de la plantilla para nodos</h3>
<div class="paragraph">
<p>Google Container Engine, Amazon EKS y demás, son productos comerciales que ya tienen establecida su URL, los nombres de las zonas de disponibilidad, los nombres de las imágenes para la creación de nodos, y demás. Sin embargo, dado que no existe un único proveedor OpenStack, los parámetros citados anteriormente como URL, nombres de zonas de disponibilidad, nombres de imagen, y demás, pueden variar (y seguro que lo hacen) de un proveedor OpenStack a otro.</p>
</div>
<div class="paragraph">
<p>Cada usuario de Rancher tendrá que configurar sus propias plantillas para especificar los distintos proveedores OpenStack a los que tenga acceso, así como las distintas configuraciones de instancia en OpenStack que quiere usar en función del tipo de nodo Kubernetes que vaya a crear.</p>
</div>
<div class="paragraph">
<p>Para crear una plantilla, en el menú desplegable del usuario seleccionamos <code>Node Templates</code> y después pulsamos el botón <code>Add Template</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-templates.png" alt="node templates.png">
</div>
</div>
<div class="paragraph">
<p>Esto abrirá un cuadro de diálogo como el de la figura siguiente, en el que tendremos que indicar los parámetros de la plataforma OpenStack a la que le vamos a solicitar los recursos, así como los parámetros de la instancia para la plantilla que estamos creando (como nombre imagen, sabor, red y demás)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-template-dialog-box.png" alt="node template dialog box.png">
</div>
</div>
<div class="paragraph">
<p>A continuación se muestran los parámetros a introducir en este cuadro de diálogo</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>activeTimeout</code>: Dejar el valor predeterminado de <code>200</code>, que será el timeout que permitimos a OpenStack para la creación de nodos.</p>
</li>
<li>
<p><code>authURL</code>: Endpoint público de Keystone que proporciona la auntenticación. En nuestro caso <a href="http://openstack.stic.ual.es:5000/v3" class="bare">http://openstack.stic.ual.es:5000/v3</a> (sólo accesible desde la VPN de la UAL). Esta información la puede encontrar el administrador de OpenStack abriendo la consola de Horizon y consultando los servicios en el menu <code>Admin | System Information</code>. También se puede obtener la URL mediante el CLI de OpenStack con:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">openstack endpoint list</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>availabilityZone</code>: Zona de disponibilidad donde se crearán las instancias para los nodos Kubernetes que se creen con esta plantilla. En nuestro caso introduciremos <code>nova</code>.</p>
</li>
<li>
<p><code>domainName</code>: Nombre del dominio al que pertenece el usuario que proporciona los recursos OpenStack a esta plantilla. En nuestro caso introduciremos <code>default</code>. En lugar de configurar el parámetro <code>domainId</code>, se podría configurar el parámetro <code>domainId</code>, pero esto es un valor más difícil de obtener.</p>
</li>
<li>
<p><code>endPointType</code>: Tipo de endpoint que usaremos para interactuar con el componente <strong>Keystone</strong> de OpenStack para la autenticación. Nosotros dejaremos <code>publicURL</code>, ya que Rancher no tiene acceso a la red de túnel ni a la de mantenimiento de OpenStack.</p>
</li>
<li>
<p><code>flavorName</code>: Nombre completo del sabor con el que se crearán los nodos que se creen con esta plantilla. En este ejemplo usaremos <code>large</code>, aunque podemos elegir cualquier otro entre los disponibles en el OpenStack al que estemos accediendo (p.e. <code>tiny, small, large, xlarge</code>, y demás).</p>
</li>
<li>
<p><code>floatingipPool</code>: Nombre de la red externa que proporciona las IP flotantes a las instancias creadas. En nuestro caso introduciremos <code>ual-net</code>.</p>
</li>
<li>
<p><code>imageName</code>: Nombre completo de la imagen a usar para crear las instancias. En nuestro caso usaremos <code>Ubuntu 18.04 LTS</code>, aunque podríamos haber usado cualquiera de las disponibles en OpenStack-STIC (<code>CentOS 7</code>, <code>Debian10</code>, <code>openSUSE Leap 15.1</code>, &#8230;&#8203;).</p>
</li>
<li>
<p><code>ipVersion</code>: Dejamos <code>4</code>, ya que las direcciones que usamos son IPv4.</p>
</li>
<li>
<p><code>keypairName</code>: Nombre del archivo de clave pública que se inyectará a la instancia en la creación, y que por tanto, <strong>deberá estar disponible con ese nombre en el proyecto OpenStack en el que se van a crear las instancias que se creen usando esta plantilla</strong>. (p.e. <code>os-sistemas</code>)</p>
</li>
<li>
<p><code>netName</code>: Nombre de la red a la que se conectarán las instancias que se creen de acuerdo con esta plantilla. Revisa las redes de tu proyecto OpenStack e identifica el nombre de la red donde se sitúarán las instancias a crear (p.e. <code>k8s-net</code>).</p>
</li>
<li>
<p><code>password</code>: Contraseña del usuario en OpenStack para poder dar acceso a Rancher para que cree las instancias.</p>
</li>
<li>
<p><code>privateKeyFile</code>: Contenido de la clave privada que usará Rancher para aprovisionar las instancias <strong>y que será la pareja de la clave pública que se ha introducido en <code>keypairName</code></strong>.</p>
</li>
<li>
<p><code>region</code>: Nombre de la región. En nuestro caso es <code>RegionOne</code></p>
</li>
<li>
<p><code>secGroups</code>: Lista de grupos de seguridad del proyecto OpenStack separadas por comas aplicables a las instancias creadas con esta plantilla (p.e. <code>default</code>)</p>
</li>
<li>
<p><code>sshPort</code>: Puerto de acceso a las instancias. Dejamos el valor <code>22</code>.</p>
</li>
<li>
<p><code>sshUser</code>: Nombre de usuario de la instancia que se va a crear, y que dependerá del tipo e imagen usada para crear la instancia. Por ejemplo, para las imágenes Ubuntu el usuario es <code>ubuntu</code>, para las Debian es <code>debian</code>, para las Fedora es <code>fedora</code>.</p>
</li>
<li>
<p><code>tenantName</code>: Nombre del proyecto OpenStack en el que se crearán las instancias que usen esta plantilla. Revisa el nombre del proyecto en Horizon para obtener este valor.</p>
</li>
<li>
<p><code>userName</code>: Nombre de usuario OpenStack que usará esta plantilla.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finalmente, asignamos un nombre a esta plantilla (p.e. `	Ubuntu 18.04 LTS large`)</p>
</div>
<div class="paragraph">
<p>A partir de este momento ya tenemos una plantilla con la que podremos crear los nodos de nuestro cluster Kubernetes. Todos los nodos que se creen usando esta plantilla tendrán las características definidas en la plantilla (imagen, sabor, red, grupos de seguridad, y demás).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-templates-list.png" alt="node templates list.png">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Creacion de varias plantillas</div>
<div class="paragraph">
<p>Para ajustar mejor la necesidad de cada tipo de nodo a crear se pueden definir plantillas diferentes con sabores diferentes con mayor o menor cantidad de recursos.</p>
</div>
<div class="paragraph">
<p>Para crear una segunda plantilla a partir de la primera, podemos clonar la plantilla anterior (con la opción <code>clone</code> que ofrece Rancher y hacerle unos ajustes para ampliar por ejemplo el <em>flavor</em> de los nodos que tengan la función <em>worker</em> en el cluster de Kubernetes).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-templates-clone.png" alt="node templates clone.png">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>La figura siguiente ilustra dos plantillas disponibles para la creación de un cluster Kubernetes, una plantilla con <em>sabor</em> <code>medium</code> para los nodos <a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/"><strong>etcd</strong></a> y <a href="https://kubernetes.io/docs/concepts/#kubernetes-control-plane"><strong>Control Plane</strong></a>, y otra plantilla con <em>sabor</em>  <code>xlarge</code> para los nodos <a href="https://kubernetes.io/docs/concepts/architecture/nodes/"><strong>Worker</strong></a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/node-templates-full-list.png" alt="node templates full list.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-cluster-kubernetes-usando-plantillas"><a class="anchor" href="#truecreaci-n-de-cluster-kubernetes-usando-plantillas"></a>2.2. Creación de cluster Kubernetes usando plantillas</h3>
<div class="paragraph">
<p>A partir de las plantillas creadas desplegaremos un cluster Kubernetes de ejemplo para tareas de CI. Las caracterísitcas de los nodos son las siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un <em>node pool</em> de 3 nodos <code>medium</code> para <code>etcd</code> y <code>Control Plane</code> con prefijo <code>k8-prod-ci</code>.</p>
</li>
<li>
<p>Un <em>node pool</em> de 4 nodos <code>xlarge</code> para <code>Worker</code> con prefijo <code>k8-prod-ci-worker</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cluster-definition.png" alt="cluster definition.png">
</div>
</div>
<div class="paragraph">
<p>Transcurridos unos minutos, el cluster estará creado y podremos ver en el proyecto OpenStack asociado las instancias creadas distinguidas con los prefijos <code>k8s-prod-ci</code> y <code>k8-prod-ci-worker</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueconfiguraci-n-de-openstack-como-proveedor-de-vol-menes"><a class="anchor" href="#trueconfiguraci-n-de-openstack-como-proveedor-de-vol-menes"></a>3. Configuración de OpenStack como proveedor de volúmenes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cinder es el componente de OpenStack que proporciona almacenamiento de bloques. Podemos usar Cinder para la creación de almacenamiento persistente en proyectos Kubernetes. Aquí veremos cómo realizar esta configuración en Rancher.</p>
</div>
<div class="paragraph">
<p>Para activar OpenStack como proveedor cloud en Rancher hay que configurar una serie de parámetros a través de un archivo de configuración en YAML para las opciones del cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La configuración en Rancher de un proveedor cloud para almacenamiento o cualquier otro servicio (p.e. balanceadores de carga) se realiza a nivel de cluster. Por tanto, habrá que realizar esta configuración en cada cluster Kubernetes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A la hora de crear el cluster, una vez definida la configuración de los nodos Master y Worker del cluster Kubernetes, configuraremos la parte relacionada con el almacenamiento en volúmenes con Cinder. Para realizar esta configuración seleccionaremos el enlace <code>Edit as YAML</code>. Esto abrirá un cuadro donde configuraremos las opciones de OpenStack y de Cinder para que se puedan proporcionar volúmenes Cinder a este cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/custom-cloud-provider.png" alt="custom cloud provider.png">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>También es posible aplicar la configuración de OpenStack como proveedor cloud sobre clusters Kubernetes existentes. Una vez realizados los cambios Rancher reconfigurará el cluster Kubernetes para que se pueda usar Cinder como proveedor de almacenamiento.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="truevalores-de-configuraci-n-del-archivo-yaml"><a class="anchor" href="#truevalores-de-configuraci-n-del-archivo-yaml"></a>3.1. Valores de configuración del archivo YAML</h3>
<div class="paragraph">
<p>A continuación se muestra el fragmento con la configuración de Cinder como proveedor de almacenamiento de bloques en el cluster. <a href="https://gist.github.com/ualmtorres/0408992657b4a5fdf985846c33da87b1">Enlace de descarga de valores de configuración</a></p>
</div>
<div class="paragraph">
<p>Las opciones de configuración están agrupadas en varias secciones. Las más importantes para la definición de volúmenes Cinder en Rancher son las secciones <code>global</code> y <code>block_storage</code> de la sección <code>openstackCloudProvider</code>. No obstante, en esta misma sección también hay otras secciones interesantes para otras situaciones específicas (p.e. la sección <code>load_balancer</code> para el uso de balanceadores de carga OpenStack <a href="https://gist.github.com/ualmtorres/3650ddd11c4973593f0ac34fa5b9f06c">Enlace de descarga de valores de configuración completos incluyendo balanceadores de carga</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">  cloud_provider:
    name: openstack
    openstackCloudProvider:
      block_storage: <i class="conum" data-value="1"></i><b>(1)</b>
        ignore-volume-az: true
        trust-device-path: false
      global:
        auth-url: 'http://openstack.stic.ual.es:5000/v3/' <i class="conum" data-value="2"></i><b>(2)</b>
        domain-name: default <i class="conum" data-value="3"></i><b>(3)</b>
        tenant-id: "your-tenant-id-here" <i class="conum" data-value="4"></i><b>(4)</b>
        username: "your-username-here" <i class="conum" data-value="5"></i><b>(5)</b>
        password: "your-password-here" <i class="conum" data-value="6"></i><b>(6)</b>
      load_balancer:
        create-monitor: false
        floating-network-id: "your-external-net-id-here" <i class="conum" data-value="7"></i><b>(7)</b>
        manage-security-groups: false
        monitor-max-retries: 0
        subnet-id: "your-subnet-id-here" <i class="conum" data-value="8"></i><b>(8)</b>
        use-octavia: false
      metadata:
        request-timeout: 0
      route: {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Opciones de configuración de Cinder</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Endpoint de autenticación de OpenStack-STIC</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre de dominio usado en OpenStack-STIC</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ID del proyecto. <strong>No se admite el nombre del proyecto</strong>. Ver a continuación información sobre Obtención del ID del proyecto</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre de usuario</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>ID de la red externa que proporciona las IPs flotantes</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>ID de la subred del proyecto</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Obtención del datos de configuración</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El ID del proyecto lo obtenemos mediante la opción de <strong>Ver credenciales</strong> que está disponible en el menú de OpenStack <code>Project | Compute | API Access</code>. A continuación pulsar el botón <code>View credentials</code></p>
<div class="imageblock">
<div class="content">
<img src="./images/API-access.png" alt="API access.png">
</div>
</div>
<div class="paragraph">
<p>Aparecerá el cuadro de diálogo <code>User Credentials Details</code> en el que se mostrará el <code>Project ID</code>, que es la información que necesitábamos para completar el YAML de configuración del cluster para uso de Cinder.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/user-credentials-details.png" alt="user credentials details.png">
</div>
</div>
</li>
<li>
<p><code>floating-network-id</code> lo obtendremos en el menú <code>Network | Networks</code>, seleccionando la red externa (<code>ual-net</code>). En la pestaña <code>Overview</code> aparecerán los datos necesarios en <code>ID</code>.</p>
<div class="imageblock">
<div class="content">
<img src="./images/floating-ip-id.png" alt="floating ip id.png">
</div>
</div>
</li>
<li>
<p>El identificador de la subred lo obtendremos en el menú <code>Network | Networks</code>, seleccionando la red del proyecto, después su subred y los datos necesarios están en <code>ID</code>.</p>
<div class="imageblock">
<div class="content">
<img src="./images/subnet-id.png" alt="subnet id.png">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-vol-menes-cinder-en-clusters-kubernetes"><a class="anchor" href="#truecreaci-n-de-vol-menes-cinder-en-clusters-kubernetes"></a>4. Creación de volúmenes Cinder en clusters Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Los contenedores pueden almacenar datos, pero los datos se pierden al eliminar los contenedores. Kubernetes ofrece volúmenes persistentes, que es almacenamiento externo al pod, ya sea en el host, en un cluster de almacenamiento o almacenamiento cloud. Si un contenedor falla, el contenedor que lo reemplace puede volver a acceder a los datos sin que se produzca pérdida de datos.</p>
</div>
<div class="paragraph">
<p>Kubernetes ofrece dos formas de almacenamiento persistente: Volúmenes persistentes (<em>Persistent Volumes, PV</em>) y Clases de almacenamiento (<em>Storage classes</em>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los volúmenes persitentes (PV):</p>
<div class="ulist">
<ul>
<li>
<p>Son volúmenes preaprovisionados que se pueden conectar más adelante a los pods.</p>
</li>
<li>
<p>Cuando se inicia la aplicación, crea una petición de volumen persistente (<em>Persistent Volume Claim, PVC</em>) y queda ligada al volumen persistente.</p>
</li>
<li>
<p>En Rancher se crean a nivel de cluster, no a nivel de proyecto.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Las clases de almacenamiento:</p>
<div class="ulist">
<ul>
<li>
<p>Representan algo así como drivers de almacenamiento (podríamos tener clases para Cinder, iSCSI, GlusterFS, NFS, &#8230;&#8203;). Más <a href="https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes">información sobre tipos de volúmenes en Kubernetes</a>.</p>
</li>
<li>
<p>Provisionan volúmenes persistentes bajo demanda.</p>
</li>
<li>
<p>Permiten crear la PVC directamente sin tener que crear primero el volumen persistente.</p>
</li>
<li>
<p>Van creando volúmenes (Cinder) que después son conectados a las PVC.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="truecreaci-n-de-una-clase-de-almacenamiento-para-cinder"><a class="anchor" href="#truecreaci-n-de-una-clase-de-almacenamiento-para-cinder"></a>4.1. Creación de una clase de almacenamiento para Cinder</h4>
<div class="paragraph">
<p>Si queremos crear volúmenes Cinder, una vez configurado el cluster para usar Cinder como proveedor de almacenamiento, tenemos que crear una clase de almacenamiento.</p>
</div>
<div class="paragraph">
<p>Para crear una clase de almacenamiento para Cinder:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Seleccionar el cluster a nivel global, no a nivel de proyecto (p.e. <code>Default</code>, <code>System</code>, &#8230;&#8203;).</p>
</li>
<li>
<p>Seleccionar <code>Storage Classes</code> en el menú <code>Storage</code></p>
<div class="imageblock">
<div class="content">
<img src="./images/storage-in-menu-bar.png" alt="storage in menu bar.png">
</div>
</div>
</li>
<li>
<p>Seleccionar <code>Add Class</code> para añadir una clase de almacenamiento</p>
<div class="imageblock">
<div class="content">
<img src="./images/add-class-button.png" alt="add class button.png">
</div>
</div>
</li>
<li>
<p>Introducir un nombre (p.e <code>Cinder</code>) y elegir <code>OpenStack Cinder Volume</code> como proveedor de almacenamiento. (En la sección <code>Customize</code> se puede configurar que se elimine o mantengan los volúmenes asociados tras eliminar un workload)</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cinder-storage-class.png" alt="cinder storage class.png">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La selección de <code>OpenStack Cinder Volume</code> como proveedor de almacenamiento tomará los valores configurados en el YAML del cluster de la sección <a href="#trueconfiguraci-n-de-openstack-como-proveedor-de-vol-menes">Configuración de OpenStack como proveedor de volúmenes</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truecreaci-n-de-un-volumen-persistente"><a class="anchor" href="#truecreaci-n-de-un-volumen-persistente"></a>4.2. Creación de un volumen persistente</h4>
<div class="ulist">
<ul>
<li>
<p>Seleccionar el cluster a nivel global, no a nivel de proyecto (<code>Default</code>, <code>System</code>, &#8230;&#8203;).</p>
</li>
<li>
<p>En el menú <code>Storage</code> seleccionar <code>Persistent Volumes</code> y pulsar el botón <code>Add Volume</code>.</p>
</li>
<li>
<p>Introducir los valores un nombre (p.e. <code>myPV</code>), elegir <code>OpenStack Cinder Volume</code> en <code>Volume Plugin</code>, una capacidad (p.e. 10 GB). En la sección <code>Plugin configuration</code> introducir valores para <code>Volume ID</code>, <code>Secret Name</code> y <code>Secret Namespace</code>.</p>
</li>
<li>
<p>En la sección <code>Customize</code> desplegar <code>Assign to Storage Class</code> y seleccionar la clase <code>cinder</code> creada anteriormente.</p>
<div class="imageblock">
<div class="content">
<img src="./images/add-persistent-volume.png" alt="add persistent volume.png">
</div>
</div>
<div class="paragraph">
<p>El volumen persistente creado aparecerá en la lista y observaremos como no aún no tiene ninguna petición de volumen persistente (<em>Persistent Volume Claim, PVC</em>), por lo que aún no se ha creado ningún volumen en Cinder.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/persistent-volume.png" alt="persistent volume.png">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="truecreaci-n-de-una-petici-n-de-volumen-persistente"><a class="anchor" href="#truecreaci-n-de-una-petici-n-de-volumen-persistente"></a>4.3. Creación de una petición de volumen persistente</h4>
<div class="paragraph">
<p>En Kubernetes se puede crear una petición de volumen persistente (<em>Persistent Volume Claim, PVC</em>) bien a partir de un volumen persitente o a partir de una clase de almacenamiento. Una PVC sí proporciona almacenamiento real para nuestro cluster y si usamos Cinder, veremos los volúmenes creados en OpenStack.</p>
</div>
<div class="paragraph">
<p>Comencemos creando una PVC. Para ello, seleccionamos el proyecto <code>Default</code> de nuestro cluster y seleccionamos el menú <code>Workloads</code>. A continuación seleccionamos el menú <code>Volumes</code> y pulsamos <code>Add Volume</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/add-volume.png" alt="add volume.png">
</div>
</div>
<div class="paragraph">
<p>A continuación tendremos que indicar si crear la PVC a partir de un volumen persistente previamente creado (p.e. <code>mypv</code>) o bien crear la PVC a partir de una de las clases de almacenamento diponibles (p.e. la clase <code>cinder</code>). Veamos cómo hacer las dos opciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Creación de la PVC a partir de un volumen persistente</strong>: Introducir un nombre (p.e. <code>pvc-from-persistent-volume</code>), seleccionar el botón de opción <code>Use an existing persistent volume</code> en la sección <code>Source</code> y elegir el volumen persistente en el desplegable <code>Persistent Volume</code> (p.e. <code>mypv</code>).</p>
<div class="imageblock">
<div class="content">
<img src="./images/pvc-persistent-volume.png" alt="pvc persistent volume.png">
</div>
</div>
<div class="paragraph">
<p>Esta acción tomará la configuración almacenada en el volumen persistente, que en el caso de <code>mypv</code> es un volumen de 10 GB. Este volumen aparecerá reservado en Cinder en el momento que lo use una aplicación.</p>
</div>
</li>
<li>
<p><strong>Creación de la PVC a partir de una clase de almacenamiento</strong>: Introducir un nombre (p.e. <code>pvc-from-storage-class</code>), seleccionar el botón de opción <code>Use a Storage Class to provision a new persistent volume</code> en la sección <code>Source</code> y elegir <code>cinder</code> en el desplegable <code>Storage Class</code>. Esta acción creará en OpenStack un volumen del tamaño especificado y con un nombre aleatorio que se corresponde con el de la PVC</p>
<div class="imageblock">
<div class="content">
<img src="./images/pvc-storage-class.png" alt="pvc storage class.png">
</div>
</div>
<div class="paragraph">
<p>A continuación se muestra el volumen creado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/pvc-creada.png" alt="pvc creada.png">
</div>
</div>
<div class="paragraph">
<p>El volumen creado en OpenStack coincide con la PVC creada desde Rancher. En nuestro caso, la PVC es <code>kubernetes-dynamic-pvc-7c9ebbab-aa63-11e9-b090-fa163ee64fe0</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/pvc-openstack.png" alt="pvc openstack.png">
</div>
</div>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Creación de aplicaciones basadas en volúmenes</div>
<div class="paragraph">
<p>El catálogo de aplicaciones de Rancher es bastante amplio. Muchas de las aplicaciones del catálogo permiten la creación de volúmenes. Por ejemplo, podemos crear un MySQL con un volumen asociado de 8 GB, tal y como muestra la figura</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/mysql-pvc.png" alt="mysql pvc.png">
</div>
</div>
<div class="paragraph">
<p>Así, de forma predeterminada tendremos un MySQL corriendo en un único pod. Una vez creado, si iniciamos sesión en MySQL, creamos una base de datos de ejemplo y eliminamos el pod, los datos no se perderán. Los datos están almacenados en una PVC, que está almacenada en un volumen Cinder en OpenStack. Si se vuelve a crear un pod que reemplace al pod eliminado, tras iniciar sesión en el nuevo pod se podrá comprobar que se tiene acceso a los mismos datos que tenía el pod eliminado.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml"><a class="anchor" href="#truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml"></a>4.4. Creación de una petición de volumen mediante manifiesto YAML</h3>
<div class="paragraph">
<p>Tanto la clase de almacenamiento, como las peticiones de volumen se pueden hacer desde la consola de Rancher o desplegando directamente manifiestos YAML.</p>
</div>
<div class="paragraph">
<p>A continuación se muestra el manifiesto YAML para la creación de una clase de almacenamiento denominada <code>cinder</code> para OpenStack Cinder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: cinder
provisioner: kubernetes.io/cinder
parameters:
  availability: nova</code></pre>
</div>
</div>
<div class="paragraph">
<p>La crearemos con <code>kubectl apply -f <a href="https://gist.githubusercontent.com/ualmtorres/c4a179accb12cf04a6af5fdc8f438f11/raw/bc274085607900f5335df8d5a2b5915e85b128f5/cinder-sc.yaml" class="bare">https://gist.githubusercontent.com/ualmtorres/c4a179accb12cf04a6af5fdc8f438f11/raw/bc274085607900f5335df8d5a2b5915e85b128f5/cinder-sc.yaml</a></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Consulta los proveedores de almacenamiento de Kubernetes en la <a href="https://kubernetes.io/docs/concepts/storage/storage-classes">documentación oficial</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez creada la clase de almacenamiento, podremos crear peticiones de volumen sobre ella. A continuación se muestra un manifiesto YAML para la creación de una PVC de 9GB sobre la clase de almacenamiento <code>cinder</code> definida anteriormente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: cinder-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 9Gi # pass here the size of the volume
  storageClassName: cinder</code></pre>
</div>
</div>
<div class="paragraph">
<p>La crearemos con <code>kubectl apply -f <a href="https://gist.githubusercontent.com/ualmtorres/788d6d7803cb32834c4afb96eeef6e5d/raw/dcf488634eac1bdbf0d4933e3eb2def55c8d8925/cinder-pvc.yaml" class="bare">https://gist.githubusercontent.com/ualmtorres/788d6d7803cb32834c4afb96eeef6e5d/raw/dcf488634eac1bdbf0d4933e3eb2def55c8d8925/cinder-pvc.yaml</a></code>.</p>
</div>
<div class="paragraph">
<p>Tras crearla, el volumen aparecerá en el menú <code>Storage | Persisten Volumes</code> de Rancher y en la zona de volúmenes de OpenStack (<code>Volumes | Volumes</code>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-vol-menes-nfs-con-openstack-manila-en-clusters-kubernetes"><a class="anchor" href="#truecreaci-n-de-vol-menes-nfs-con-openstack-manila-en-clusters-kubernetes"></a>5. Creación de volúmenes NFS con Openstack Manila en clusters Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes permite montar shares NFS existentes. Los volúmenes NFS son volúmenes externos al cluster Kubernetes y son persistentes, de forma que su contenido se mantiene después de la eliminación de los pods que lo tengan montado.</p>
</div>
<div class="paragraph">
<p>Para este ejemplo usaremos Openstack Manila como servidor NFS. Para los ejemplos ya tenemos creado un <em>share</em>, disponible en en la ruta /var/lib/manila/mnt/share-c3e6b450-9e7b-4144-a113-84cbcd50ddd6 del servidor 192.168.128.17. Dicho <em>share</em> ya tiene configuradas las reglas de acceso de forma que pueda ser montado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/share.png" alt="share.png">
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-un-volumen-persistente-2"><a class="anchor" href="#truecreaci-n-de-un-volumen-persistente-2"></a>5.1. Creación de un volumen persistente</h3>
<div class="ulist">
<ul>
<li>
<p>Seleccionar el cluster a nivel global, no a nivel de proyecto (<code>Default</code>, <code>System</code>, &#8230;&#8203;).</p>
</li>
<li>
<p>En el menú <code>Storage</code> seleccionar <code>Persistent Volumes</code> y pulsar el botón <code>Add Volume</code>.</p>
</li>
<li>
<p>Introducir los valores un nombre (p.e. <code>my-share-pv</code>), elegir <code>NFS Share</code> en <code>Volume Plugin</code>, una capacidad (p.e. <code>10 GB</code>). En la sección <code>Plugin Configuration</code> introducir los valores del <code>path</code> y del <code>server</code> que ha proporcionado OpenStack Manila para el <em>share</em> creado.</p>
<div class="imageblock">
<div class="content">
<img src="./images/share-rancher.png" alt="share rancher.png">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A partir desde volumen persistente, podríamos crear <em>volume claims</em> sobre él desde la opción <code>Default</code> del cluster en <code>Resources | Volumes | Add Volume</code> y seleccionando <code>Use an existing persistent volume</code> en <code>Source</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml-2"><a class="anchor" href="#truecreaci-n-de-una-petici-n-de-volumen-mediante-manifiesto-yaml-2"></a>5.2. Creación de una petición de volumen mediante manifiesto YAML</h3>
<div class="paragraph">
<p>Tanto los volúmnes persistentes como las peticiones de volumen se pueden hacer desde la consola de Rancher o desplegando directamente manifiestos YAML.</p>
</div>
<div class="paragraph">
<p>A continuación se muestra el manifiesto YAML para la creación de un volumen persistente NFS para un <em>share</em> de OpenStack Manila</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: PersistentVolume
metadata:
  name: nfs-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Recycle
  nfs:
    path: /var/lib/manila/mnt/share-c3e6b450-9e7b-4144-a113-84cbcd50ddd6
    server: 192.168.128.17</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo crearemos con <code>kubectl apply -f <a href="https://gist.githubusercontent.com/ualmtorres/3fe119adcacf269442da0d0db9adcc3d/raw/1e54dd73a00bd55f70dd229fab1123c2a5d89787/nfs-pv.yaml" class="bare">https://gist.githubusercontent.com/ualmtorres/3fe119adcacf269442da0d0db9adcc3d/raw/1e54dd73a00bd55f70dd229fab1123c2a5d89787/nfs-pv.yaml</a></code></p>
</div>
<div class="paragraph">
<p>Una vez creado el volumen persistente, podremos crear peticiones de volumen sobre él. A continuación se muestra un manifiesto YAML para la creación de una PVC de 10GB sobre el volumen <code>nfs-pv</code> definido anteriormente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: nfs-pvc
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 10Gi
  storageClassName: ""
  volumeName: nfs-pv</code></pre>
</div>
</div>
<div class="paragraph">
<p>La crearemos con <code>kubectl apply -f <a href="https://gist.githubusercontent.com/ualmtorres/4adbc23ae9237197be32d622bad8876c/raw/3403e9da298c971d739575e0aab8f221e99158e3/nfs-pvc.yaml" class="bare">https://gist.githubusercontent.com/ualmtorres/4adbc23ae9237197be32d622bad8876c/raw/3403e9da298c971d739575e0aab8f221e99158e3/nfs-pvc.yaml</a></code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueconclusiones"><a class="anchor" href="#trueconclusiones"></a>6. Conclusiones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rancher ofrece una plataforma integrada para creación y mantenimiento de clusters Kubernetes. En el caso de que usemos proveedores públicos (Google, Azure, Amazon, &#8230;&#8203;) para el despliegue de la infraestructura, basta con completar los parámetros que proporcione el proveedor. Sin embargo, dado que cada cloud OpenStack al que tengamos acceso puede tener parámetros de configuración diferentes (p.e. nombre de las imágenes, sabores, red externa, y demás), debemos configurar nuestras propias plantillas de acuerdo con la instalación de OpenStack a la que tengamos acceso.</p>
</div>
<div class="paragraph">
<p>En este tutorial hemos visto cómo crear estas plantillas y cómo personalizar la configuración mediante YAML para almacenamiento y balanceadores de carga OpenStack. También hemos visto cómo crear almacenamiento persistente para clusters Kubernetes usando OpenStack Cinder y OpenStack Manila como proveedores de almacenamiento.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-11 17:34:43 CEST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>