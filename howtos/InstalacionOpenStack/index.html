<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Cloud-DI">
<title>Instalación de OpenStack</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Instalación de OpenStack</h1>
<div class="details">
<span id="author" class="author">Cloud-DI</span><br>
<span id="revdate">Cloud-DI Team &lt;clouddi@ual.es&gt;</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de contenidos</div>
<ul class="sectlevel1">
<li><a href="#trueresumen">Resumen</a></li>
<li><a href="#truecomponentes-de-openstack">1. Componentes de OpenStack</a></li>
<li><a href="#truepreparaci-n-del-entorno">2. Preparación del entorno</a>
<ul class="sectlevel2">
<li><a href="#trueconfiguraci-n-de-las-interfaces-de-red">2.1. Configuración de las interfaces de red</a></li>
</ul>
</li>
<li><a href="#truepreparaci-n-de-las-m-quinas">3. Preparación de las máquinas</a></li>
<li><a href="#trueinstalaci-n-de-keystone">4. Instalación de Keystone</a></li>
<li><a href="#trueinstalaci-n-de-glance">5. Instalación de Glance</a></li>
<li><a href="#trueinstalaci-n-de-nova">6. Instalación de Nova</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-nova-en-el-nodo-de-control">6.1. Instalación de Nova en el nodo de control</a></li>
<li><a href="#trueinstalaci-n-de-nova-en-los-nodos-de-c-mputo">6.2. Instalación de Nova en los nodos de cómputo</a></li>
<li><a href="#trueconfiguraci-n-de-nova-en-el-nodo-de-control">6.3. Configuración de Nova en el nodo de control</a></li>
</ul>
</li>
<li><a href="#trueneutron">7. Neutron</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-neutron-en-el-nodo-de-control">7.1. Instalación de Neutron en el nodo de control</a></li>
<li><a href="#trueinstalaci-n-de-neutron-en-el-nodo-de-red">7.2. Instalación de Neutron en el nodo de red</a></li>
<li><a href="#trueinstalaci-n-de-neutron-en-los-nodos-de-c-mputo">7.3. Instalación de Neutron en los nodos de cómputo</a></li>
<li><a href="#trueconfiguraci-n-de-la-red">7.4. Configuración de la red</a></li>
</ul>
</li>
<li><a href="#truehorizon">8. Horizon</a></li>
<li><a href="#trueneutron-lbaas">9. Neutron LBaaS</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-control">9.1. Instalación de Neutron LBaaS en el nodo de control</a></li>
<li><a href="#trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-red">9.2. Instalación de Neutron LBaaS en el nodo de red</a></li>
</ul>
</li>
<li><a href="#truecinder">10. Cinder</a></li>
<li><a href="#trueheat">11. Heat</a></li>
<li><a href="#truemanila">12. Manila</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-manila-en-el-nodo-de-control">12.1. Instalación de Manila en el nodo de control</a></li>
<li><a href="#trueinstalaci-n-de-manila-en-el-nodo-de-almacenamiento-compartido">12.2. Instalación de Manila en el nodo de almacenamiento compartido</a></li>
<li><a href="#trueconfiguraci-n-de-manila-en-el-nodo-de-control">12.3. Configuración de Manila en el nodo de control</a></li>
</ul>
</li>
<li><a href="#trueswift">13. Swift</a>
<ul class="sectlevel2">
<li><a href="#trueinstalaci-n-de-swift-en-el-nodo-de-control">13.1. Instalación de Swift en el nodo de control</a></li>
<li><a href="#trueinstalar-swift-en-nodos-de-almacenamiento-de-objetos">13.2. Instalar Swift en nodos de almacenamiento de objetos</a></li>
<li><a href="#truecrear-y-distribuir-los-anillos-iniciales">13.3. Crear y distribuir los anillos iniciales</a></li>
<li><a href="#truemodificar-la-configuraci-n-de-swift">13.4. Modificar la configuración de Swift</a></li>
<li><a href="#trueiniciar-y-reiniciar-servicios">13.5. Iniciar y reiniciar servicios</a></li>
</ul>
</li>
<li><a href="#truesahara">14. Sahara</a></li>
<li><a href="#trueanexo-1-esquema-de-red">Anexo 1. Esquema de red</a></li>
<li><a href="#trueanexo-2-paquetes-y-archivos-de-configuraci-n">Anexo 2. Paquetes y archivos de configuración</a></li>
<li><a href="#trueanexo-3-servicios-en-ejecuci-n-en-cada-servidor">Anexo 3. Servicios en ejecución en cada servidor</a></li>
<li><a href="#trueanexo-4-tablas-no-vac-as-de-las-bases-de-datos-de-openstack">Anexo 4. Tablas no vacías de las bases de datos de OpenStack</a></li>
<li><a href="#trueanexo-5-consultas-sql-de-utilidad">Anexo 5. Consultas SQL de utilidad</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/di.png" alt="di.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueresumen"><a class="anchor" href="#trueresumen"></a>Resumen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenStack es un software para la creación de clouds. El proyecto OpenStack ofrece gran cantidad de componentes para implementar los diferentes servicios que se quieran desplegar en nuestro cloud (máquinas virtuales, infraestructura de red, almacenamiento de bloques, almacenamiento de archivos compartidos, almacenamiento de objetos, orquestación, monitorización, por citar algunos). OpenStack tiene una arquitectura totalmente modular en la que partiendo de los componentes básicos (<em>Keystone</em> para autenticación, <em>Glance</em> para imágenes, <em>Neutron</em> para redes y <em>Nova</em> para instancias) podemos ir añadiendo los componentes adecuados para poder desplegar los servicios que queremos ofrecer.</p>
</div>
<div class="paragraph">
<p>En este tutorial se describen los pasos de instalación de los componentes que actualmente están disponibles en <a href="https://openstack.di.ual.es/horizon">OpenStack-DI</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El acceso a OpenStack-DI y a otros recursos más de Cloud-DI se puede hacer directamente desde <a href="https://openstack.di.ual.es/horizon">https://openstack.di.ual.es/horizon</a> o desde la web de servicios de Cloud-DI <a href="https://cloud.di.ual.es">https://cloud.di.ual.es</a>. Allí además hay disponible una lista de respuestas a preguntas frecuentes y los <a href="https://cloud.di.ual.es/TerminosServicio.html">Términos de servicio de Cloud-DI</a>.</p>
</div>
<div class="paragraph">
<p>En <a href="https://moodle.di.ual.es">https://moodle.di.ual.es</a> se encuentran disponibles una serie de videos ilustrativos sobre los sevicios ofrecidos por Cloud-DI y sobre las operaciones básicas para el uso de OpenStack-DI.</p>
</div>
<div class="paragraph">
<p>Para realizar operaciones repetitivas o avanzadas es conveniente utilizar el CLI. Aquí está disponible la <a href="https://docs.openstack.org/python-openstackclient/pike/cli/command-list.html#command-list">Lista de comandos CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecomponentes-de-openstack"><a class="anchor" href="#truecomponentes-de-openstack"></a>1. Componentes de OpenStack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenStack es un proyecto formado por distintos componentes. Cada uno de ellos añade una función a nuestro cloud (networking, almacenamiento, máquinas virtuales, orquestación, &#8230;&#8203;). Podemos clasificar estos componentes en básicos y opcionales.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Componentes básicos</p>
<div class="ulist">
<ul>
<li>
<p><em>Keystone</em>: Servicio de Identidad (*)</p>
</li>
<li>
<p><em>Neutron</em>: Servicio de redes (*)</p>
</li>
<li>
<p><em>Glance</em>: Servicio de imágenes (*)</p>
</li>
<li>
<p><em>Nova</em>: Servicio de cómputo (máquinas virtuales) (*)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Componentes opcionales</p>
<div class="ulist">
<ul>
<li>
<p><em>Horizon</em>: Interfaz web (*)</p>
</li>
<li>
<p><em>Cinder</em>: Almacenamiento de bloques (*)</p>
</li>
<li>
<p><em>Manila</em>: Servicio de sistemas de archivos compartidos (*)</p>
</li>
<li>
<p><em>Swift</em>: Servicio de almacenamiento de objetos (*)</p>
</li>
<li>
<p><em>Sahara</em>: Servicio de procesamiento de datos (*)</p>
</li>
<li>
<p><em>Ceilometer</em>: Servicio de recolección de datos de telemetría</p>
</li>
<li>
<p><em>Aodh</em>: Servicio de alerta de telemetría</p>
</li>
<li>
<p><em>Heat</em>: Servicio de orquestación (*)</p>
</li>
<li>
<p><em>Barbican</em>: Servicio de gestión de claves (*)</p>
</li>
<li>
<p><em>Ironic</em>: Aprovisionamiento en máquinas físicas</p>
</li>
<li>
<p><em>Cloudkitty</em>: Servicio de tarificación</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los componentes marcardos con asterisco (*) están disponibles actualmente en <a href="https://openstack.di.ual.es/horizon">OpenStack-DI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La figura siguiente ilustra los componentes instalados en OpenStack-DI y su interacción básica. Los componentes en rojo son los componentes básicos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ComponentesOpenStack.png" alt="ComponentesOpenStack.png">
</div>
<div class="title">Figure 1. Componentes de OpenStack-DI</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Keystone</em> proporciona servicios de identificación a todos los componentes OpenStack</p>
</li>
<li>
<p><em>Horizon</em> proporciona un portal web de acceso al resto de componentes salvo a <em>Keystone</em>.</p>
</li>
<li>
<p><em>Glance</em> proporciona las imágenes al crear las máquinas virtuales.</p>
</li>
<li>
<p><em>Neutron</em> proporciona los servicios de networking a las máquinas virtuales</p>
</li>
<li>
<p><em>Cinder</em> propociona almacenamiento de bloques a las máquinas virtuales. <em>Cinder</em> también puede guardar snapshots de volumen.</p>
</li>
<li>
<p><em>Manila</em> propociona servicios de almacenamiento compartido de archivos a las máquinas virtuales</p>
</li>
<li>
<p><em>Swift</em> propociona almacenamiento de objetos a las máquinas virtuales y a <em>Sahara</em>. Opcionalmente se puede configurar <em>Nova</em> para almacenar las imágenes en <em>Swift</em>.</p>
</li>
<li>
<p><em>Ceilometer</em> recoge medidas de uso de los componentes de networking, imágenes, cómputo, almacenamiento y procesamiento de datos.</p>
</li>
<li>
<p><em>Heat</em> permite la creación de stacks para la creación de infraestructura mediante código. Opcionalmente se puede combinar con <em>Ceilometer</em> par ajustar dinánicamente la infraestructura en función del uso de recursos (RAM, cores, almacenamiento) recopilado por <em>Ceilometer</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los componentes de OpenStack exponen una API que es usada por los distintos servicios. Cada componente también suele utilizar una base de datos donde registra sus elementos, estado, operaciones, y demás. La comunicación con la base de datos se realiza con el protocolo <a href="https://es.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol">AMQP</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truepreparaci-n-del-entorno"><a class="anchor" href="#truepreparaci-n-del-entorno"></a>2. Preparación del entorno</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para la instalación de los componentes de este tutorial partimos del siguiente escenario en el que contaremos con servidores dedicados para Control, Red y Cómputo. Los servicios de almacenamiento tienen los requisitos siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Cinder</em>: Almacenamiento en un NAS Synology y servicios ejecutándose en el nodo de Control.</p>
</li>
<li>
<p><em>Manila</em>: Servidor independiente.</p>
</li>
<li>
<p><em>Swift</em>: Dos servidores para proporcionar tolerancia a fallos.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La figura siguiente ilustra la arquitectura de referencia que usaremos en este tutorial. Tal y como aparece en la <a href="https://docs.openstack.org/ocata/install-guide-ubuntu/environment-networking.html">Guía de networking en la instalación de OpenStack</a> dispondremos de una red de mantenimiento, una red de túnel y la red externa.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/configuracionDeseable.png" alt="configuracionDeseable.png">
</div>
<div class="title">Figure 2. Configuración y conexión de servidores</div>
</div>
<div class="paragraph">
<p>Como se observa en la figura, todos los servidores están conectados a las redes de mantenimiento y túnel.</p>
</div>
<div class="paragraph">
<p>Además, los servidores siguientes están contectados al exterior a través de una red externa, que proporciona conexión a Internet a las máquinas virtuales, y en el caso de OpenStack-DI al almacenamiento de archivos compartidos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Control: Proporciona acceso a la consola de <em>Horizon</em> en la red de la UAL.</p>
</li>
<li>
<p>Red: Ofrece conectividad a la red de la UAL a las máquinas virtuales.</p>
</li>
<li>
<p>Almacenamiento compartido: Permite ofrecer sistemas de archivos de compartidos en la red de la UAL.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La red de mantenimiento proporciona comunicación interna entre los componentes de OpenStack. La red de túnel (también conocida como <code>guest</code>) proporciona comunicación a las máquinas virtuales con los recursos del cloud.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los requisitos hardware mínimos de cada servidor son los que aparecen el la <a href="https://docs.openstack.org/ocata/install-guide-ubuntu/overview.html#example-architecture">arquitectura de ejemplo de la guía de instalación de OpenStack</a>.</p>
</div>
<div class="sect2">
<h3 id="trueconfiguraci-n-de-las-interfaces-de-red"><a class="anchor" href="#trueconfiguraci-n-de-las-interfaces-de-red"></a>2.1. Configuración de las interfaces de red</h3>
<div class="paragraph">
<p>Es recomendable, aunque no necesario, una nomenclatura uniforme de las interfaces de red de los servidores que ofrecen la infraestructura a OpenStack. Si hay diferencias, recomendamos seguir la denominación clásica <code>eth0</code>, <code>eth1</code>, &#8230;&#8203; Sigue como <code>root</code> estos pasos cambiar los nombres de la interfaces de red a <code>eth0</code>, <code>eth1</code>, &#8230;&#8203;</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Editar <code>/etc/default/grub</code> y cambiar la línea <code>GRUB_CMDLINE_LINUX=""</code> por  <code>GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"</code>.</p>
</li>
<li>
<p>Actualizar GRUB con <code>update-grub</code>.</p>
</li>
<li>
<p>Actualizar el archivo <code>/etc/network/interfaces</code> con las interfaces de red ya a <code>eth0</code>, <code>eth1</code>, &#8230;&#8203;</p>
</li>
<li>
<p>Reiniciar el sistema con <code>reboot</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truepreparaci-n-de-las-m-quinas"><a class="anchor" href="#truepreparaci-n-de-las-m-quinas"></a>3. Preparación de las máquinas</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En cada máquina crear un archivo <code>/etc/hosts</code> con las direcciones IP de la red de mantenimiento y los nombres que vayamos a dar a las máquinas:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">10.0.0.51 testcontroller

10.0.0.52 testnetwork

10.0.0.53 testcompute01
10.0.0.54 testcompute02
10.0.0.55 testcompute03
10.0.0.56 testcompute04

10.0.0.61 testobject01
10.0.0.62 testobject02

10.0.0.63 testshared</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar <code>chrony</code> en todas las máquinas</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt-get install chrony</code></pre>
</div>
</div>
</li>
<li>
<p>Modificar en la máquina de control el archivo <code>/etc/chrony/chrony.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">Archivo <code>/etc/chrony/chrony.conf</code> en el nodo de control</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">pool 2.debian.pool.ntp.org offline iburst

server 1.es.pool.ntp.org iburst <i class="conum" data-value="1"></i><b>(1)</b>
allow 10.0.0.0/24 <i class="conum" data-value="2"></i><b>(2)</b>

keyfile /etc/chrony/chrony.keys

commandkey 1

driftfile /var/lib/chrony/chrony.drift

log tracking measurements statistics
logdir /var/log/chrony

maxupdateskew 100.0

dumponexit

dumpdir /var/lib/chrony

logchange 0.5

hwclockfile /etc/adjtime

rtcsync</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Servidor NTP</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Red de mantenimiento</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar en el resto de máquinas el archivo <code>/etc/chrony/chrony.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">Archivo <code>/etc/chrony/chrony.conf</code> en el resto de nodos</div>
<hr>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">server {{ nodes.controller.name }} iburst <i class="conum" data-value="1"></i><b>(1)</b>

keyfile /etc/chrony/chrony.keys

commandkey 1

driftfile /var/lib/chrony/chrony.drift

log tracking measurements statistics
logdir /var/log/chrony

maxupdateskew 100.0

dumponexit

dumpdir /var/lib/chrony

logchange 0.5

hwclockfile /etc/adjtime

rtcsync</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del servidor de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar <code>chrony</code> en todos los nodos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service chrony restart</code></pre>
</div>
</div>
</li>
<li>
<p>Revisar funcionamiento de <code>chrony</code> en todos los nodos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># chronyc sources</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir el repositorio de OpenStack Ocata en todos los nodos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt-get install software-properties-common
# add-apt-repository cloud-archive:ocata
# apt update &amp;&amp; apt dist-upgrade</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar el cliente Python para OpenStack en todos los nodos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install python-openstackclient</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar la base de datos en el nodo de control</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt-get install mariadb-server python-pymysql libmysqlclient-dev</code></pre>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/mysql/mariadb.conf.d/99-openstack.cnf</code> en el nodo de control</p>
<div class="sidebarblock">
<div class="content">
<div class="title">Archivo <code>/etc/mysql/mariadb.conf.d/99-openstack.cnf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[mysqld]
bind-address = {{ nodes.controller.management_ip }} <i class="conum" data-value="1"></i><b>(1)</b>

default-storage-engine = innodb
innodb_file_per_table = on
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dirección IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/root/my.cnf</code> en el nodo de control</p>
<div class="sidebarblock">
<div class="content">
<div class="title">Archivo <code>/root/my.cnf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[client]
user=root
password={{ mysql_root_password }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario <code>root</code> de MySQL</td>
</tr>
</table>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service mysql restart
# mysql_secure_installation</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar la cola de mensajes en el nodo de control</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install rabbitmq-server
# rabbitmqctl add_user openstack {{ RABBIT_PASS }} <i class="conum" data-value="1"></i><b>(1)</b>
# rabbitmqctl set_permissions openstack ".*" ".*" ".*"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar Memcached en el nodo de control</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install memcached python-memcache</code></pre>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/memcached.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">Archivo <code>/etc/memcached.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">-d

logfile /var/log/memcached.log

-m 64

-p 11211

-u memcache

-l {{ nodes.controller.management_ip }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dirección IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar Memcached</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service memcached restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstalaci-n-de-keystone"><a class="anchor" href="#trueinstalaci-n-de-keystone"></a>4. Instalación de Keystone</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La instalación de Keystone se realiza en el nodo de control</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>keystone</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE keystone;
Grant proper access to the keystone database:

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' \
IDENTIFIED BY {{ 'KEYSTONE_DBPASS' }}; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' \
IDENTIFIED BY {{ 'KEYSTONE_DBPASS' }}; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Keystone</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Keystone</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Keystone</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install keystone</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/keystone/keystone.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/keystone/keystone.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

[assignment]

[auth]

[cache]

[catalog]

[cors]

[cors.subdomain]

[credential]

[database]

connection = mysql+pymysql://keystone:{{ keystone_dbpass }}@{{ nodes.controller.name }}/keystone <i class="conum" data-value="1"></i><b>(1)</b>

[domain_config]

[endpoint_filter]

[endpoint_policy]

[eventlet_server]

[extra_headers]

[federation]

[fernet_tokens]

[healthcheck]

[identity]

[identity_mapping]

[kvs]

[ldap]

[matchmaker_redis]

[memcache]

[oauth1]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[paste_deploy]

[policy]

[profiler]

[resource]

[revoke]

[role]

[saml]

[security_compliance]

[shadow_users]

[signing]

[token]

provider = fernet

[tokenless_auth]

[trust]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Keystone y nombre del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar MySQL</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service mysql restart</code></pre>
</div>
</div>
</li>
<li>
<p>Inicializar la base de datos Keystone:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "keystone-manage db_sync" keystone</code></pre>
</div>
</div>
</li>
<li>
<p>Inicializar los repositorios de claves Fernet</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</code></pre>
</div>
</div>
</li>
<li>
<p>Iniciar los servicios de Keystone</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">keystone-manage bootstrap --bootstrap-password {{ admin_pass}} --bootstrap-admin-url http://{{ nodes_by_name.controller.management_ip }}:35357/v3/ --bootstrap-internal-url http://{{ nodes_by_name.controller.tunnel_ip }}:5000/v3/ --bootstrap-public-url http://{{ nodes_by_name.controller.provider_ip}}:5000/v3/ --bootstrap-region-id {{ region }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Completar con la contraseña de <code>admin</code>, las direcciones IP del nodo de control y el nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/apache2/apache2.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/apache2/apache2.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Mutex file:${APACHE_LOCK_DIR} default

PidFile ${APACHE_PID_FILE}

Timeout 300

KeepAlive On

MaxKeepAliveRequests 100

KeepAliveTimeout 5

User ${APACHE_RUN_USER}
Group ${APACHE_RUN_GROUP}

HostnameLookups Off

ErrorLog ${APACHE_LOG_DIR}/error.log

LogLevel warn

IncludeOptional mods-enabled/*.load
IncludeOptional mods-enabled/*.conf

Include ports.conf

&lt;Directory /&gt;
	Options FollowSymLinks
	AllowOverride None
	Require all denied
&lt;/Directory&gt;

&lt;Directory /usr/share&gt;
	AllowOverride None
	Require all granted
&lt;/Directory&gt;

&lt;Directory /var/www/&gt;
	Options Indexes FollowSymLinks
	AllowOverride None
	Require all granted
&lt;/Directory&gt;

AccessFileName .htaccess

&lt;FilesMatch "^\.ht"&gt;
	Require all denied
&lt;/FilesMatch&gt;

LogFormat "%v:%p %h %l %u %t \"%r\" %&gt;s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined
LogFormat "%h %l %u %t \"%r\" %&gt;s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %&gt;s %O" common
LogFormat "%{Referer}i -&gt; %U" referer
LogFormat "%{User-agent}i" agent

IncludeOptional conf-enabled/*.conf

IncludeOptional sites-enabled/*.conf

ServerName {{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configurar <code>ServerName</code> con el nombre del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar Apache</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar la base de datos SQLite predetermianda</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># rm -rf /var/lib/keystone/keystone.db</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo de credenciales del usuario <code>admin</code>. Crear un archivo denominado <code>openrc-admin</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">export OS_USERNAME=admin
export OS_PASSWORD={{ admin_pass }} <i class="conum" data-value="1"></i><b>(1)</b>
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_AUTH_URL=http://{{ nodes.controller.name }}:35357/v3 <i class="conum" data-value="2"></i><b>(2)</b>
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
export OS_AUTH_TYPE=password</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurar el archivo de credenciales del usuario <code>demo</code>. Crear un archivo denominado <code>openrc-demo</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">export OS_USERNAME=demo
export OS_PASSWORD={{ demo_pass }} <i class="conum" data-value="1"></i><b>(1)</b>
export OS_PROJECT_NAME=demo
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_AUTH_URL=http://{{ nodes.controller.name }}:5000/v3 <i class="conum" data-value="2"></i><b>(2)</b>
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
export OS_AUTH_TYPE=password</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de <code>demo</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Keystone (dominio <code>default</code>, proyectos <code>service</code> y <code>demo</code>, usuario <code>demo</code>, rol <code>user</code> y añadir el usuario <code>demo</code> al proyecto <code>demo</code> con el rol <code>user</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack domain create --description "Default Domain" default
# openstack project create --domain default --description "Service Project" service
# openstack project create --domain default --description "Demo Project" demo
# openstack user create --domain default demo --password {{ demo_pass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role create user
# openstack role add --project demo --user demo user</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>demo</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/keystone/keystone-paste.ini</code></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/keystone/keystone-paste.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[filter:debug]
use = egg:oslo.middleware#debug

[filter:request_id]
use = egg:oslo.middleware#request_id

[filter:build_auth_context]
use = egg:keystone#build_auth_context

[filter:token_auth]
use = egg:keystone#token_auth

[filter:admin_token_auth]
use = egg:keystone#admin_token_auth

[filter:json_body]
use = egg:keystone#json_body

[filter:cors]
use = egg:oslo.middleware#cors
oslo_config_project = keystone

[filter:http_proxy_to_wsgi]
use = egg:oslo.middleware#http_proxy_to_wsgi

[filter:healthcheck]
use = egg:oslo.middleware#healthcheck

[filter:ec2_extension]
use = egg:keystone#ec2_extension

[filter:ec2_extension_v3]
use = egg:keystone#ec2_extension_v3

[filter:s3_extension]
use = egg:keystone#s3_extension

[filter:url_normalize]
use = egg:keystone#url_normalize

[filter:sizelimit]
use = egg:oslo.middleware#sizelimit

[filter:osprofiler]
use = egg:osprofiler#osprofiler

[app:public_service]
use = egg:keystone#public_service

[app:service_v3]
use = egg:keystone#service_v3

[app:admin_service]
use = egg:keystone#admin_service

[pipeline:public_api]
pipeline = healthcheck cors sizelimit http_proxy_to_wsgi osprofiler url_normalize request_id build_auth_context token_auth json_body ec2_extension public_service

[pipeline:admin_api]
pipeline = healthcheck cors sizelimit http_proxy_to_wsgi osprofiler url_normalize request_id build_auth_context token_auth json_body ec2_extension s3_extension admin_service

[pipeline:api_v3]
pipeline = healthcheck cors sizelimit http_proxy_to_wsgi osprofiler url_normalize request_id build_auth_context token_auth json_body ec2_extension_v3 s3_extension service_v3

[app:public_version_service]
use = egg:keystone#public_version_service

[app:admin_version_service]
use = egg:keystone#admin_version_service

[pipeline:public_version_api]
pipeline = healthcheck cors sizelimit osprofiler url_normalize public_version_service

[pipeline:admin_version_api]
pipeline = healthcheck cors sizelimit osprofiler url_normalize admin_version_service

[composite:main]
use = egg:Paste#urlmap
/v2.0 = public_api
/v3 = api_v3
/ = public_version_api

[composite:admin]
use = egg:Paste#urlmap
/v2.0 = admin_api
/v3 = api_v3
/ = admin_version_api</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstalaci-n-de-glance"><a class="anchor" href="#trueinstalaci-n-de-glance"></a>5. Instalación de Glance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La instalación de Glance se realiza en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>glance</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE glance;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \
  IDENTIFIED BY 'GLANCE_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \
  IDENTIFIED BY 'GLANCE_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Glance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Glance</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Glance (usuario <code>glance</code>, añadir el usuario <code>glance</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear el servicio <code>glance</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default glance --password {{ glance_dbpass }} <i class="conum" data-value="1"></i><b>(1)</b>
# openstack role add --project service --user glance admin
# openstack service create --name glance --description "OpenStack Image" image</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>glance</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} image public http://{{ nodes_by_name.controller.provider_ip }}:9292 <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} image internal http://{{ nodes_by_name.controller.tunnel_ip }}:9292 <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} image admin http://{{ nodes_by_name.controller.management_ip }}:9292 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Glance</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install glance</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/glance/glance-api.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/glance/glance-api.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

[cors]

[cors.subdomain]

[database]

sqlite_db = /var/lib/glance/glance.sqlite

backend = sqlalchemy

connection = mysql+pymysql://glance:{{ glance_dbpass }}@{{ nodes.controller.name }}/glance <i class="conum" data-value="2"></i><b>(2)</b>

[glance_store]

stores = file,http
default_store = file
filesystem_store_datadir = {{ glance_image_dir }} <i class="conum" data-value="3"></i><b>(3)</b>

[image_format]

disk_formats = ami,ari,aki,vhd,vhdx,vmdk,raw,qcow2,vdi,iso,ploop.root-tar

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="4"></i><b>(4)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="5"></i><b>(5)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = {{ glance_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[oslo_concurrency]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[paste_deploy]

flavor = keystone

[profiler]

[store_type_location_strategy]

[task]

[taskflow_executor]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de Glance y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Directorio donde se vayan a almacenar las imágenes (p.e. <code>/var/lib/glance/images</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Contraseña de Glance</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/glance/glance-registry.conf</code></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/glance/glance-registry.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

[database]

sqlite_db = /var/lib/glance/glance.sqlite

backend = sqlalchemy

connection = mysql+pymysql://glance:{{ glance_dbpass }}@{{ nodes.controller.name }}/glance <i class="conum" data-value="2"></i><b>(2)</b>

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="3"></i><b>(3)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="4"></i><b>(4)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="5"></i><b>(5)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = glance
password = {{ glance_dbpass }}

[matchmaker_redis]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_policy]

[paste_deploy]

flavor = keystone

[profiler]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de Glance y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña de Glance</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Poblar la base de datos <code>glance</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "glance-manage db_sync" glance</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios de Glance</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service glance-registry restart
# service glance-api restart</code></pre>
</div>
</div>
</li>
<li>
<p>Verificar funcionaminento</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img <i class="conum" data-value="1"></i><b>(1)</b>
# openstack image create "cirros" \
  --file cirros-0.3.5-x86_64-disk.img \
  --disk-format qcow2 --container-format bare \
  --public <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Descargar imagen de prueba de CirrOS</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Subir imagen a OpenStack</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstalaci-n-de-nova"><a class="anchor" href="#trueinstalaci-n-de-nova"></a>6. Instalación de Nova</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueinstalaci-n-de-nova-en-el-nodo-de-control"><a class="anchor" href="#trueinstalaci-n-de-nova-en-el-nodo-de-control"></a>6.1. Instalación de Nova en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estar operaciones en el nodo de control</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>nova</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE nova_api;
MariaDB [(none)]&gt; CREATE DATABASE nova;
MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b>

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="3"></i><b>(3)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="4"></i><b>(4)</b>

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="5"></i><b>(5)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO 'nova'@'%' \
  IDENTIFIED BY 'NOVA_DBPASS'; <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña del usuario Nova</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Nova (usuario <code>nova</code>, añadir el usuario <code>nova</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear el servicio <code>nova</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default nova --password {{ nova_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user nova admin
# openstack service create --name nova --description "OpenStack Compute" compute</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>nova</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{ region }} compute public http://{{ nodes_by_name.controller.provider_ip }}:8774/v2.1 <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{ region }} compute internal http://{{ nodes_by_name.controller.tunnel_ip }}:8774/v2.1 <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{ region }} compute admin http://{{ nodes_by_name.controller.management_ip }}:8774/v2.1 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración del servicio Placement (usuario <code>nova</code>, añadir el usuario <code>nova</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear el servicio <code>nova</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default placement --password {{ placement_pass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user placement admin
# openstack service create --name placement --description "Placement API" placement</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>placement</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{ region }} placement public http://{{ nodes_by_name.controller.provider_ip }}:8778 <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{ region }} placement internal http://{{ nodes_by_name.controller.tunnel_ip }}:8778 <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{ region }} placement admin http://{{ nodes_by_name.controller.management_ip }}:8778 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Nova</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install nova-api nova-conductor nova-consoleauth \
  nova-novncproxy nova-scheduler nova-placement-api</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/nova/nova.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/nova/nova.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
my_ip = {{ nodes.controller.management_ip }} <i class="conum" data-value="1"></i><b>(1)</b>

use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver

dhcpbridge_flagfile=/etc/nova/nova.conf

dhcpbridge=/usr/bin/nova-dhcpbridge

linuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver

force_dhcp_release=true

state_path=/var/lib/nova

enabled_apis=osapi_compute,metadata

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="2"></i><b>(2)</b>

[api]

auth_strategy = keystone

[api_database]

connection = mysql+pymysql://nova:{{ nova_dbpass }}@{{ nodes.controller.name }}/nova_api <i class="conum" data-value="3"></i><b>(3)</b>

[barbican]

[cache]

[cells]

enable=False

[cinder]

os_region_name = {{region}} <i class="conum" data-value="4"></i><b>(4)</b>

[cloudpipe]

[conductor]

[console]

[consoleauth]

[cors]

[cors.subdomain]

[crypto]

[database]

connection = mysql+pymysql://nova:{{ nova_dbpass }}@{{ nodes.controller.name }}/nova <i class="conum" data-value="5"></i><b>(5)</b>

[ephemeral_storage_encryption]

[filter_scheduler]

[glance]

api_servers = http://{{ nodes.controller.name }}:9292 <i class="conum" data-value="6"></i><b>(6)</b>

[guestfs]

[healthcheck]

[hyperv]

[image_file_url]

[ironic]

[key_manager]

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="7"></i><b>(7)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="8"></i><b>(8)</b>
memcached_servers = {{nodes.controller.name}}:11211 <i class="conum" data-value="9"></i><b>(9)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = {{ nova_dbpass }} <i class="conum" data-value="10"></i><b>(10)</b>

[libvirt]

[matchmaker_redis]

[metrics]

[mks]

[neutron]

url = http://{{ nodes.controller.name }}:9696 <i class="conum" data-value="11"></i><b>(11)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="12"></i><b>(12)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = {{ region }} <i class="conum" data-value="13"></i><b>(13)</b>
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="14"></i><b>(14)</b>
service_metadata_proxy = true
metadata_proxy_shared_secret = {{ metadata_secret }} <i class="conum" data-value="15"></i><b>(15)</b>

[notifications]

[osapi_v21]

[oslo_concurrency]

lock_path = /var/lib/nova/tmp

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[pci]

[placement]

os_region_name = {{ region }} <i class="conum" data-value="16"></i><b>(16)</b>
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://{{ nodes.controller.name }}:35357/v3 <i class="conum" data-value="17"></i><b>(17)</b>
username = placement
password = {{ placement_pass }} <i class="conum" data-value="18"></i><b>(18)</b>

[quota]

[rdp]

[remote_debug]

[scheduler]

periodic_task_interval=300

[serial_console]

[service_user]

[spice]

[ssl]

[trusted_computing]

[upgrade_levels]

[vendordata_dynamic_auth]

[vmware]

[vnc]

enabled = true
vncserver_listen = $my_ip
vncserver_proxyclient_address = $my_ip

[workarounds]

[wsgi]

api_paste_config=/etc/nova/api-paste.ini

[xenserver]

[xvp]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Nova y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Contraseña de Nova y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Contraseña de Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Secreto para metadatos</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="18"></i><b>18</b></td>
<td>Contraseña de Placement</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Crear las bases de datos y las celdas <code>cell0</code> y <code>cell1</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "nova-manage api_db sync" nova
# su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova
# su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova 109e1d4b-536a-40d0-83c6-5f121b82b650
# su -s /bin/sh -c "nova-manage db sync" nova</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service nova-api restart
# service nova-consoleauth restart
# service nova-scheduler restart
# service nova-conductor restart
# service nova-novncproxy restart</code></pre>
</div>
</div>
</li>
<li>
<p>Verificar creación de celdas</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># nova-manage cell_v2 list_cells</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-nova-en-los-nodos-de-c-mputo"><a class="anchor" href="#trueinstalaci-n-de-nova-en-los-nodos-de-c-mputo"></a>6.2. Instalación de Nova en los nodos de cómputo</h3>
<div class="paragraph">
<p>Realizar estar operaciones en cada uno de los nodos de cómputo</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar los paquetes de Nova</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install nova-compute</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/nova/nova.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/nova/nova.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

my_ip = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>
use_neutron = True
firewall_driver = nova.virt.firewall.NoopFirewallDriver

network_api_class = nova.network.neutronv2.api.API
security_group_api = neutron

instance_usage_audit_period=hour

instance_usage_audit=True

dhcpbridge_flagfile=/etc/nova/nova.conf

dhcpbridge=/usr/bin/nova-dhcpbridge

linuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver

force_dhcp_release=true

state_path=/var/lib/nova

enabled_apis=osapi_compute,metadata

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="2"></i><b>(2)</b>

[api]

auth_strategy = keystone

[api_database]

connection = mysql+pymysql://nova:{{ nova_dbpass }}@{{ nodes.controller.name }}/nova_api <i class="conum" data-value="3"></i><b>(3)</b>

[barbican]

[cache]

[cells]

enable=False

[cinder]

[cloudpipe]

[conductor]

[console]

[consoleauth]

[cors]

[cors.subdomain]

[crypto]

[database]

connection = mysql+pymysql://nova:{{ nova_dbpass }}@{{ nodes.controller.name }}/nova <i class="conum" data-value="4"></i><b>(4)</b>

[ephemeral_storage_encryption]

[filter_scheduler]

[glance]

api_servers = http://{{ nodes.controller.name }}:9292 <i class="conum" data-value="5"></i><b>(5)</b>

[guestfs]

[healthcheck]

[hyperv]

[image_file_url]

[ironic]

[key_manager]

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="6"></i><b>(6)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="7"></i><b>(7)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="8"></i><b>(8)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = nova
password = {{ nova_dbpass }} <i class="conum" data-value="9"></i><b>(9)</b>

[libvirt]

cpu_mode=custom

cpu_model=kvm64

[matchmaker_redis]

[metrics]

[mks]

[neutron]

url = http://{{ nodes.controller.name }}:9696 <i class="conum" data-value="10"></i><b>(10)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="11"></i><b>(11)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = {{ region }} <i class="conum" data-value="12"></i><b>(12)</b>
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="13"></i><b>(13)</b>

[notifications]

notify_on_state_change=vm_and_task_state

[osapi_v21]

[oslo_concurrency]

lock_path = /var/lib/nova/tmp

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[pci]

[placement]

os_region_name = {{ region }} <i class="conum" data-value="14"></i><b>(14)</b>
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://{{ nodes.controller.name }}:35357/v3 <i class="conum" data-value="15"></i><b>(15)</b>
username = placement
password = {{ placement_pass }} <i class="conum" data-value="16"></i><b>(16)</b>

[quota]

[rdp]

[remote_debug]

[scheduler]

[serial_console]

[service_user]

[spice]

[ssl]

[trusted_computing]

[upgrade_levels]

[vendordata_dynamic_auth]

[vmware]

[vnc]

enabled = True
vncserver_listen = 0.0.0.0
vncserver_proxyclient_address = $my_ip
novncproxy_base_url = http://{{ nodes_by_name.controller.provider_ip }}:6080/vnc_auto.html <i class="conum" data-value="17"></i><b>(17)</b>

[workarounds]

[wsgi]

api_paste_config=/etc/nova/api-paste.ini

[xenserver]

[xvp]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP del nodo de cómputo</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Nova y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña de Nova y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Contraseña de Nova</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>IP externa del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar servicios de nova</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service nova-compute restart</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueconfiguraci-n-de-nova-en-el-nodo-de-control"><a class="anchor" href="#trueconfiguraci-n-de-nova-en-el-nodo-de-control"></a>6.3. Configuración de Nova en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estar operaciones en el nodo de control</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear los sabores</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack flavor create --vcpus 1 --ram 512 --disk 1 tiny
# openstack flavor create --vcpus 1 --ram 2048 --disk 20 small
# openstack flavor create --vcpus 2 --ram 4096 --disk 40 medium
# openstack flavor create --vcpus 4 --ram 8192 --disk 80 large
# openstack flavor create --vcpus 8 --ram 16384 --disk 160 xlarge</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Descubrir los servidores de cómputo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueneutron"><a class="anchor" href="#trueneutron"></a>7. Neutron</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueinstalaci-n-de-neutron-en-el-nodo-de-control"><a class="anchor" href="#trueinstalaci-n-de-neutron-en-el-nodo-de-control"></a>7.1. Instalación de Neutron en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estar operaciones en el nodo de control</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>neutron</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE neutron;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \
  IDENTIFIED BY 'NEUTRON_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \
  IDENTIFIED BY 'NEUTRON_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b>
Exit</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Neutron</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Neutron (usuario <code>neutron</code>, añadir el usuario <code>neutron</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear el servicio <code>neutron</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default neutron --password {{ neutron_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user neutron admin
# openstack service create --name neutron --description "OpenStack Networking" network</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>nova</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} neutron public http://{{ nodes_by_name.controller.provider_ip }}:9696 <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} neutron internal http://{{ nodes_by_name.controller.tunnel_ip }}:9696 <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} neutron admin http://{{ nodes_by_name.controller.management_ip }}:9696 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install neutron-server neutron-plugin-ml2</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/neutron.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/neutron.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

auth_strategy = keystone

core_plugin = ml2
service_plugins = router,neutron_lbaas.services.loadbalancer.plugin.LoadBalancerPluginv2
allow_overlapping_ips = true
transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

notify_nova_on_port_status_changes = true

notify_nova_on_port_data_changes = true

dhcp_agents_per_network = {{ compute_nodes_quantity }} <i class="conum" data-value="2"></i><b>(2)</b>

[agent]

root_helper = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://neutron:{{ neutron_dbpass }}@{{ nodes.controller.name }}/neutron <i class="conum" data-value="3"></i><b>(3)</b>

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="4"></i><b>(4)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="5"></i><b>(5)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[nova]

auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="8"></i><b>(8)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = {{ region }} <i class="conum" data-value="9"></i><b>(9)</b>
project_name = service
username = nova
password = {{ nova_dbpass }} <i class="conum" data-value="10"></i><b>(10)</b>

[oslo_concurrency]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[qos]

[quotas]

[ssl]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cantidad de servidores de cómputo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Neutron y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Contraseña de Nova</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/plugins/ml2/ml2_conf.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

[ml2]

type_drivers = flat,vlan,vxlan

tenant_network_types = vxlan

mechanism_drivers = openvswitch,l2population

extension_drivers = port_security

[ml2_type_flat]

[ml2_type_geneve]

[ml2_type_gre]

[ml2_type_vlan]

[ml2_type_vxlan]

vni_ranges = 1:1000

[securitygroup]

firewall_driver = iptables_hybrid

enable_security_group = true

enable_ipset = true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Poblar la base de datos de Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar Neutron</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service neutron-server restart</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-neutron-en-el-nodo-de-red"><a class="anchor" href="#trueinstalaci-n-de-neutron-en-el-nodo-de-red"></a>7.2. Instalación de Neutron en el nodo de red</h3>
<div class="paragraph">
<p>Realizar estos pasos en el nodo de red</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En este tutorial seguimos el <a href="https://docs.openstack.org/kilo/networking-guide/scenario_provider_ovs.html">escenario de <em>provider networks</em> con OpenvSwich</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configurar el kernel para desactivar el <em>reverse path filtering</em>. Añadir estas líneas el archivo <code>/etc/sysctl.conf</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">net.ipv4.ip_forward=1
net.ipv4.conf.all.rp_filter=0
net.ipv4.conf.default.rp_filter=0</code></pre>
</div>
</div>
</li>
<li>
<p>Cargar la nueva configuración del kernel</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># sysctl -p</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent neutron-metadata-agent</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/neutron.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/neutron.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

auth_strategy = keystone

core_plugin = ml2
service_plugins = router,neutron_lbaas.services.loadbalancer.plugin.LoadBalancerPluginv2
allow_overlapping_ips = true
transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

notify_nova_on_port_status_changes = true

notify_nova_on_port_data_changes = true

dhcp_agents_per_network = {{ compute_nodes_quantity }} <i class="conum" data-value="2"></i><b>(2)</b>

[agent]

root_helper = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://neutron:{{ neutron_dbpass }}@{{ nodes.controller.name }}/neutron <i class="conum" data-value="3"></i><b>(3)</b>

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="4"></i><b>(4)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="5"></i><b>(5)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[nova]

auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="8"></i><b>(8)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = {{ region }} <i class="conum" data-value="9"></i><b>(9)</b>
project_name = service
username = nova
password = {{ nova_dbpass }} <i class="conum" data-value="10"></i><b>(10)</b>

[oslo_concurrency]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[qos]

[quotas]

[ssl]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cantidad de servidores de cómputo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Neutron y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Contraseña de Nova</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/l3_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/l3_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

interface_driver = openvswitch

agent_mode = legacy

handle_internal_only_routers = true

enable_metadata_proxy = true

external_network_bridge =

[agent]

[ovs]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/dhcp_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/dhcp_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

ovs_integration_bridge = br-int

interface_driver = openvswitch

dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq

enable_isolated_metadata = true

dnsmasq_config_file = /etc/neutron/dnsmasq-neutron.conf

[agent]

[ovs]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/dnsmasq-neutron.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/dnsmasq-neutron.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"> -s
dhcp-option-force=26,1450</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/metadata_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/metadata_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="1"></i><b>(1)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="2"></i><b>(2)</b>
auth_region = {{ region }} <i class="conum" data-value="3"></i><b>(3)</b>
auth_plugin = password
project_domain_id = default
user_domain_id = default
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="4"></i><b>(4)</b>

nova_metadata_ip = {{ nodes.controller.management_ip }} <i class="conum" data-value="5"></i><b>(5)</b>

nova_metadata_port = 8775

metadata_proxy_shared_secret = {{ metadata_secret }} <i class="conum" data-value="6"></i><b>(6)</b>

nova_metadata_protocol = http

[agent]

[cache]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Secreto para metadatos</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[ovs]
integration_bridge = br-int

int_peer_patch_port = patch-tun

local_ip = {{ ansible_eth1.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>

bridge_mappings = provider:br-ex

[agent]

polling_interval = 15

tunnel_types = vxlan

l2_population = True

arp_responder = False

enable_distributed_routing = False

[securitygroup]
firewall_driver = iptables_hybrid

enable_security_group = True</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de la red de túnel del nodo de red</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar el servicio <code>openvswitch-switch</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service openvswitch-switch restart</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir el bridge externo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># ovs-vsctl add-br br-ex</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir puerto al bridge externo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># ovs-vsctl add-port br-ex {{ provider_interface }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre de la interfaz de red externa en el nodo de red</td>
</tr>
</table>
</div>
</li>
<li>
<p>Añadir el bridge interno</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># ovs-vsctl add-br br-int</code></pre>
</div>
</div>
</li>
<li>
<p>Crear el siguiente script en <code>/root/br-ex_setup.sh</code> para configurar la interfaz externa en el nodo de red. Ejecutar el script.</p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo  <code>/root/br-ex_setup.sh</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">/sbin/ip route |grep default |grep br-ex

if [ $? -ne 0 ]; then
    /sbin/ip route del default
    /sbin/ip addr del {{ nodes_by_name.network.provider_ip }}/24 dev {{ provider_interface }}
    /sbin/ip link set br-ex up
    /sbin/ip link set {{ provider_interface }} promisc on
    /sbin/ip addr add {{ nodes_by_name.network.provider_ip }}/24 dev br-ex
    /sbin/ip route add default via {{ provider_gateway }}
fi</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/network/interfaces</code> para añadir el bridge externo</p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/network/interfaces</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

# The management network interface
auto {{management_interface}} <i class="conum" data-value="1"></i><b>(1)</b>
iface {{management_interface}} inet static <i class="conum" data-value="2"></i><b>(2)</b>
  address {{ nodes_by_name.network.management_ip }} <i class="conum" data-value="3"></i><b>(3)</b>
  netmask {{ management_mask }} <i class="conum" data-value="4"></i><b>(4)</b>
  network {{management_network}} <i class="conum" data-value="5"></i><b>(5)</b>
  mtu {{ MTU }} <i class="conum" data-value="6"></i><b>(6)</b>

# The tunnel network interface
auto {{tunnel_interface}} <i class="conum" data-value="7"></i><b>(7)</b>
iface {{tunnel_interface}} inet static <i class="conum" data-value="8"></i><b>(8)</b>
  address {{ nodes_by_name.network.tunnel_ip }} <i class="conum" data-value="9"></i><b>(9)</b>
  netmask {{ tunnel_mask }} <i class="conum" data-value="10"></i><b>(10)</b>
  network {{tunnel_network}} <i class="conum" data-value="11"></i><b>(11)</b>
  mtu {{ MTU }} <i class="conum" data-value="12"></i><b>(12)</b>

auto br-ex
allow-ovs br-ex
iface br-ex inet static
  address {{ nodes_by_name.network.provider_ip }} <i class="conum" data-value="13"></i><b>(13)</b>
  netmask {{ provider_mask }} <i class="conum" data-value="14"></i><b>(14)</b>
  gateway {{ provider_gateway }} <i class="conum" data-value="15"></i><b>(15)</b>
  dns-nameservers {{ dns }} <i class="conum" data-value="16"></i><b>(16)</b>
  ovs_type OVSBridge
  ovs_ports {{ provider_interface }} <i class="conum" data-value="17"></i><b>(17)</b>

allow-br-ex {{ provider_interface }} <i class="conum" data-value="18"></i><b>(18)</b>
iface {{ provider_interface }} inet manual <i class="conum" data-value="19"></i><b>(19)</b>
   ovs_bridge br-ex
  ovs_type OVSPort
  up ip link set $IFACE promisc on
  down ip link set $IFACE promisc off</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre de la interfaz de mantenimiento del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre de la interfaz de mantenimiento del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Dirección IP de mantenimiento del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Máscara de red la red de mantenimiento</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Red de mantenimiento</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>MTU</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Nombre de la interfaz de túnel del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre de la interfaz de túnel del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Dirección IP de túnel del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Máscara de red la red de túnel</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Red de mantenimiento</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>MTU</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Dirección IP externa del nodo de red</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Máscara de red la red externa</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Gateway de la red external</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>IP del DNS</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>Nombre de la interfaz de red externa</td>
</tr>
<tr>
<td><i class="conum" data-value="18"></i><b>18</b></td>
<td>Nombre de la interfaz de red externa</td>
</tr>
<tr>
<td><i class="conum" data-value="19"></i><b>19</b></td>
<td>Nombre de la interfaz de red externa</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios de Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service neutron-openvswitch-agent restart
# service neutron-dhcp-agent restart
# service neutron-metadata-agent restart
# service neutron-l3-agent restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-neutron-en-los-nodos-de-c-mputo"><a class="anchor" href="#trueinstalaci-n-de-neutron-en-los-nodos-de-c-mputo"></a>7.3. Instalación de Neutron en los nodos de cómputo</h3>
<div class="paragraph">
<p>Realizar estos pasos en cada uno de los nodos de cómputo</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configurar el kernel para desactivar el <em>reverse path filtering</em>. Añadir estas líneas el archivo <code>/etc/sysctl.conf</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">net.ipv4.conf.all.rp_filter=0
net.ipv4.conf.default.rp_filter=0</code></pre>
</div>
</div>
</li>
<li>
<p>Cargar la nueva configuración del kernel</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># sysctl -p</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install neutron-openvswitch-agent</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/neutron.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/neutron.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

auth_strategy = keystone

core_plugin = ml2
service_plugins = router,neutron_lbaas.services.loadbalancer.plugin.LoadBalancerPluginv2
allow_overlapping_ips = true
transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

notify_nova_on_port_status_changes = true

notify_nova_on_port_data_changes = true

dhcp_agents_per_network = {{ compute_nodes_quantity }} <i class="conum" data-value="2"></i><b>(2)</b>

[agent]

root_helper = sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://neutron:{{ neutron_dbpass }}@{{ nodes.controller.name }}/neutron <i class="conum" data-value="3"></i><b>(3)</b>

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="4"></i><b>(4)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="5"></i><b>(5)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = neutron
password = {{ neutron_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[nova]

auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="8"></i><b>(8)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = {{ region }} <i class="conum" data-value="9"></i><b>(9)</b>
project_name = service
username = nova
password = {{ nova_dbpass }} <i class="conum" data-value="10"></i><b>(10)</b>

[oslo_concurrency]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[qos]

[quotas]

[ssl]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cantidad de servidores de cómputo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Neutron y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Contraseña de Neutron</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre de la región (p.e. <code>RegionOne</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Contraseña de Nova</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[ovs]
integration_bridge = br-int

int_peer_patch_port = patch-tun

local_ip = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>

bridge_mappings = provider:br-ex

[agent]

polling_interval = 15

tunnel_types = vxlan

l2_population = True

arp_responder = False

enable_distributed_routing = False

[securitygroup]
firewall_driver = iptables_hybrid

enable_security_group = True</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de cómputo</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar el agente OpenvSwitch</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service neutron-openvswitch-agent restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueconfiguraci-n-de-la-red"><a class="anchor" href="#trueconfiguraci-n-de-la-red"></a>7.4. Configuración de la red</h3>
<div class="paragraph">
<p>Realizar estas operaciones en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear la red externa</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack network create  --share --external --provider-physical-network provider --provider-network-type flat {{network_name}} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre de la red externa</td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear la subred de la red externa</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack subnet create --network {{network_name}} \ <i class="conum" data-value="1"></i><b>(1)</b>
    --allocation-pool start={{allocation_pool_start}},end={{allocation_pool_end}} \ <i class="conum" data-value="2"></i><b>(2)</b>
    --dns-nameserver {{dns_name_servers}} \ <i class="conum" data-value="3"></i><b>(3)</b>
    --gateway {{provider_gateway}} \ <i class="conum" data-value="4"></i><b>(4)</b>
    --subnet-range {{subnet_range}} \ <i class="conum" data-value="5"></i><b>(5)</b>
    {{subnet_name}} <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre de la red externa</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Direcciones IP inicial y final del pool de direcciones asignadas</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>IP de servidores DNS</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Gateway de la red externa</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre de la subred</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truehorizon"><a class="anchor" href="#truehorizon"></a>8. Horizon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Realizar estos pasos en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar Neutron</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install openstack-dashboard</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/openstack-dashboard/local_settings.py</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/openstack-dashboard/local_settings.py</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">import os

from django.utils.translation import ugettext_lazy as _

from horizon.utils import secret_key

from openstack_dashboard.settings import HORIZON_CONFIG

DEBUG = False

WEBROOT = '/'

ALLOWED_HOSTS = ['*']

OPENSTACK_API_VERSIONS = {
    "identity": 3,
    "image": 2,
    "volume": 2,
}

OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True

OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = 'Default'

LOCAL_PATH = os.path.dirname(os.path.abspath(__file__))

SECRET_KEY = secret_key.generate_or_read_from_file('/var/lib/openstack-dashboard/secret_key')

SESSION_ENGINE = 'django.contrib.sessions.backends.cache'

CACHES = {
    'default': {
         'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache',
         'LOCATION': '{{ nodes.controller.name }}:11211', <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

OPENSTACK_HOST = "{{ nodes.controller.name }}" <i class="conum" data-value="2"></i><b>(2)</b>
OPENSTACK_KEYSTONE_URL = "http://%s:5000/v3" % OPENSTACK_HOST

OPENSTACK_KEYSTONE_DEFAULT_ROLE = "user"

OPENSTACK_KEYSTONE_BACKEND = {
    'name': 'native',
    'can_edit_user': True,
    'can_edit_group': True,
    'can_edit_project': True,
    'can_edit_domain': True,
    'can_edit_role': True,
}

OPENSTACK_HYPERVISOR_FEATURES = {
    'can_set_mount_point': False,
    'can_set_password': False,
    'requires_keypair': False,
    'enable_quotas': True
}

OPENSTACK_CINDER_FEATURES = {
    'enable_backup': False,
}

OPENSTACK_NEUTRON_NETWORK = {
    'enable_router': True,
    'enable_quotas': True,
    'enable_ipv6': True,
    'enable_distributed_router': False,
    'enable_ha_router': False,
    'enable_lb': True,
    'enable_firewall': True,
    'enable_vpn': True,
    'enable_fip_topology_check': True,

    # Default dns servers you would like to use when a subnet is
    # created.  This is only a default, users can still choose a different
    # list of dns servers when creating a new subnet.
    # The entries below are examples only, and are not appropriate for
    # real deployments
    # 'default_dns_nameservers': ["8.8.8.8", "8.8.4.4", "208.67.222.222"],

    # The profile_support option is used to detect if an external router can be
    # configured via the dashboard. When using specific plugins the
    # profile_support can be turned on if needed.
    'profile_support': None,
    #'profile_support': 'cisco',

    # Set which provider network types are supported. Only the network types
    # in this list will be available to choose from when creating a network.
    # Network types include local, flat, vlan, gre, vxlan and geneve.
    # 'supported_provider_types': ['*'],

    # You can configure available segmentation ID range per network type
    # in your deployment.
    # 'segmentation_id_range': {
    #     'vlan': [1024, 2048],
    #     'vxlan': [4094, 65536],
    # },

    # You can define additional provider network types here.
    # 'extra_provider_types': {
    #     'awesome_type': {
    #         'display_name': 'Awesome New Type',
    #         'require_physical_network': False,
    #         'require_segmentation_id': True,
    #     }
    # },

    # Set which VNIC types are supported for port binding. Only the VNIC
    # types in this list will be available to choose from when creating a
    # port.
    # VNIC types include 'normal', 'macvtap' and 'direct'.
    # Set to empty list or None to disable VNIC type selection.
    'supported_vnic_types': ['*'],
}

OPENSTACK_HEAT_STACK = {
    'enable_user_pass': True,
}

IMAGE_CUSTOM_PROPERTY_TITLES = {
    "architecture": _("Architecture"),
    "kernel_id": _("Kernel ID"),
    "ramdisk_id": _("Ramdisk ID"),
    "image_state": _("Euca2ools state"),
    "project_id": _("Project ID"),
    "image_type": _("Image Type"),
}

IMAGE_RESERVED_CUSTOM_PROPERTIES = []

API_RESULT_LIMIT = 1000
API_RESULT_PAGE_SIZE = 20

SWIFT_FILE_TRANSFER_CHUNK_SIZE = 512 * 1024

INSTANCE_LOG_LENGTH = 35

DROPDOWN_MAX_ITEMS = 30

TIME_ZONE = "Europe/Madrid"

AVAILABLE_THEMES = [
    ('default', 'Default', 'themes/default'),
    ('material', 'Material', 'themes/material'),
]

LOGGING = {
    'version': 1,
    # When set to True this will disable all logging except
    # for loggers specified in this configuration dictionary. Note that
    # if nothing is specified here and disable_existing_loggers is True,
    # django.db.backends will still log unless it is disabled explicitly.
    'disable_existing_loggers': False,
    'formatters': {
        'operation': {
            # The format of "%(message)s" is defined by
            # OPERATION_LOG_OPTIONS['format']
            'format': '%(asctime)s %(message)s'
        },
    },
    'handlers': {
        'null': {
            'level': 'DEBUG',
            'class': 'logging.NullHandler',
        },
        'console': {
            # Set the level to "DEBUG" for verbose output logging.
            'level': 'INFO',
            'class': 'logging.StreamHandler',
        },
        'operation': {
            'level': 'INFO',
            'class': 'logging.StreamHandler',
            'formatter': 'operation',
        },
    },
    'loggers': {
        # Logging from django.db.backends is VERY verbose, send to null
        # by default.
        'django.db.backends': {
            'handlers': ['null'],
            'propagate': False,
        },
        'requests': {
            'handlers': ['null'],
            'propagate': False,
        },
        'horizon': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'horizon.operation_log': {
            'handlers': ['operation'],
            'level': 'INFO',
            'propagate': False,
        },
        'openstack_dashboard': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'novaclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'cinderclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'keystoneclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'glanceclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'neutronclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'heatclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'swiftclient': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'openstack_auth': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'nose.plugins.manager': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'django': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': False,
        },
        'iso8601': {
            'handlers': ['null'],
            'propagate': False,
        },
        'scss': {
            'handlers': ['null'],
            'propagate': False,
        },
    },
}

SECURITY_GROUP_RULES = {
    'all_tcp': {
        'name': _('All TCP'),
        'ip_protocol': 'tcp',
        'from_port': '1',
        'to_port': '65535',
    },
    'all_udp': {
        'name': _('All UDP'),
        'ip_protocol': 'udp',
        'from_port': '1',
        'to_port': '65535',
    },
    'all_icmp': {
        'name': _('All ICMP'),
        'ip_protocol': 'icmp',
        'from_port': '-1',
        'to_port': '-1',
    },
    'ssh': {
        'name': 'SSH',
        'ip_protocol': 'tcp',
        'from_port': '22',
        'to_port': '22',
    },
    'smtp': {
        'name': 'SMTP',
        'ip_protocol': 'tcp',
        'from_port': '25',
        'to_port': '25',
    },
    'dns': {
        'name': 'DNS',
        'ip_protocol': 'tcp',
        'from_port': '53',
        'to_port': '53',
    },
    'http': {
        'name': 'HTTP',
        'ip_protocol': 'tcp',
        'from_port': '80',
        'to_port': '80',
    },
    'pop3': {
        'name': 'POP3',
        'ip_protocol': 'tcp',
        'from_port': '110',
        'to_port': '110',
    },
    'imap': {
        'name': 'IMAP',
        'ip_protocol': 'tcp',
        'from_port': '143',
        'to_port': '143',
    },
    'ldap': {
        'name': 'LDAP',
        'ip_protocol': 'tcp',
        'from_port': '389',
        'to_port': '389',
    },
    'https': {
        'name': 'HTTPS',
        'ip_protocol': 'tcp',
        'from_port': '443',
        'to_port': '443',
    },
    'smtps': {
        'name': 'SMTPS',
        'ip_protocol': 'tcp',
        'from_port': '465',
        'to_port': '465',
    },
    'imaps': {
        'name': 'IMAPS',
        'ip_protocol': 'tcp',
        'from_port': '993',
        'to_port': '993',
    },
    'pop3s': {
        'name': 'POP3S',
        'ip_protocol': 'tcp',
        'from_port': '995',
        'to_port': '995',
    },
    'ms_sql': {
        'name': 'MS SQL',
        'ip_protocol': 'tcp',
        'from_port': '1433',
        'to_port': '1433',
    },
    'mysql': {
        'name': 'MYSQL',
        'ip_protocol': 'tcp',
        'from_port': '3306',
        'to_port': '3306',
    },
    'rdp': {
        'name': 'RDP',
        'ip_protocol': 'tcp',
        'from_port': '3389',
        'to_port': '3389',
    },
}

REST_API_REQUIRED_SETTINGS = ['OPENSTACK_HYPERVISOR_FEATURES',
                              'LAUNCH_INSTANCE_DEFAULTS',
                              'OPENSTACK_IMAGE_FORMATS',
                              'OPENSTACK_KEYSTONE_DEFAULT_DOMAIN']

 # The default theme if no cookie is present
DEFAULT_THEME = 'default'

WEBROOT='/horizon/'

ALLOWED_HOSTS = '*'

COMPRESS_OFFLINE = True

ALLOWED_PRIVATE_SUBNET_CIDR = {'ipv4': [], 'ipv6': []}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar Apache y Memcached</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service apache2 reload
# service apache2 restart
# service memcached restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueneutron-lbaas"><a class="anchor" href="#trueneutron-lbaas"></a>9. Neutron LBaaS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-control"><a class="anchor" href="#trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-control"></a>9.1. Instalación de Neutron LBaaS en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estos pasos en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar <code>python-neutron-lbaas</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install python-neutron-lbaas</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/neutron_lbaas.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/neutron_lbaas.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

[certificates]

[quotas]

[service_auth]

[service_providers]

service_provider = LOADBALANCERV2:Haproxy:neutron_lbaas.drivers.haproxy.plugin_driver.HaproxyOnHostPluginDriver:default</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Realizar la migración de la base de datos <code>neutron-lbaas</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "neutron-db-manage --subproject neutron-lbaas upgrade head"</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar Neutron <code>neutron-server</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service neutron-server restart</code></pre>
</div>
</div>
</li>
<li>
<p>Clonar el repositorio de <code>neutron-lbaas</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># git clone https://git.openstack.org/openstack/neutron-lbaas-dashboard /tmp/neutron-lbaas-dashboard</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Neutron LBaaS no tiene empaquetada la integración con Horizon. En estos casos descargaremos los fuentes del dashboard, los procesaremos y los integraremos en Horizon.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar el dashboard de Neutron LBaaS desde <code>/tmp/neutron-lbaas-dashboard/</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /tmp/neutron-lbaas-dashboard/
# python setup.py install</code></pre>
</div>
</div>
</li>
<li>
<p>Copiar los archivos del dashboard de Neutron LBaaS</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cp /tmp/neutron-lbaas-dashboard/neutron_lbaas_dashboard/enabled/_1481_project_ng_loadbalancersv2_panel.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar el módulo <code>pexpect</code> con <code>pip</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">pip install pexpect</code></pre>
</div>
</div>
</li>
<li>
<p>Realizar estos últimos pasos para terminar de integrar el dashboard en Horizon</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /usr/share/openstack-dashboard
# python manage.py collectstatic <i class="conum" data-value="1"></i><b>(1)</b>
# python manage.py compress</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Responder <code>yes</code> a la pregunta</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reiniciar el servidor Apache</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service apache2 restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-red"><a class="anchor" href="#trueinstalaci-n-de-neutron-lbaas-en-el-nodo-de-red"></a>9.2. Instalación de Neutron LBaaS en el nodo de red</h3>
<div class="paragraph">
<p>Realizar estos pasos en el nodo de red.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar <code>neutron-lbaasv2-agent</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install neutron-lbaasv2-agent</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/lbaas_agent.ini</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/lbaas_agent.ini</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

device_driver = neutron_lbaas.drivers.haproxy.namespace_driver.HaproxyNSDriver
interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver

[haproxy]
user_group = haproxy</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/neutron/neutron_lbaas.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/neutron/neutron_lbaas.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

[certificates]

[quotas]

[service_auth]

[service_providers]

service_provider = LOADBALANCERV2:Haproxy:neutron_lbaas.drivers.haproxy.plugin_driver.HaproxyOnHostPluginDriver:default</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar el servicio neutron-lbaasv2-agent</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service neutron-lbaasv2-agent restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecinder"><a class="anchor" href="#truecinder"></a>10. Cinder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Realizar estar operaciones en el nodo de control.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La instalación de Cinder descrita en este tutorial hace uso de un NAS como dispositivo de almacenamiento de volúmenes. Cinder mantiene una <a href="https://docs.openstack.org/cinder/ocata/drivers.html">serie de dispositivos compatibles</a> y que disponen de drivers para poder funcionar como nodo de almacenamiento. Esto permite contar con un nodo de almacenamiento a un coste menor que un servidor dedicado. Los paquetes y archivos de configuración quedan instalados en el nodo de control.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>cinder</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE cinder;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' \
  IDENTIFIED BY 'CINDER_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' \
  IDENTIFIED BY 'CINDER_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Cinder</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Cinder</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Cinder (usuario <code>cinder</code>, añadir el usuario <code>cinder</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear los servicios <code>cinder</code>, <code>cinderv2</code> y <code>cinderv3</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default cinder --password {{ cinder_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user cinder admin
# openstack service create --name cinder --description "OpenStack Block Storage" volume
# openstack service create --name cinderv2 --description "OpenStack Block Storage" volumev2
# openstack service create --name cinderv3 --description "OpenStack Block Storage" volumev3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Credenciales del usuario <code>cinder</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} cinder public http://{{ nodes_by_name.controller.provider_ip }}:8776/v1/%(project_id)s <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} cinder internal http://{{ nodes_by_name.controller.tunnel_ip }}:8776/v1/%(project_id)s <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} cinder admin http://{{ nodes_by_name.controller.management_ip }}:8776/v1/%(project_id)s <i class="conum" data-value="3"></i><b>(3)</b>

# openstack endpoint create --region {{region}} cinderv2 public http://{{ nodes_by_name.controller.provider_ip }}:8776/v2/%(project_id)s <i class="conum" data-value="4"></i><b>(4)</b>
# openstack endpoint create --region {{region}} cinderv2 internal http://{{ nodes_by_name.controller.tunnel_ip }}:8776/v2/%(project_id)s <i class="conum" data-value="5"></i><b>(5)</b>
# openstack endpoint create --region {{region}} cinderv3 admin http://{{ nodes_by_name.controller.management_ip }}:8776/v2/%(project_id)s <i class="conum" data-value="6"></i><b>(6)</b>

# openstack endpoint create --region {{region}} cinderv3 public http://{{ nodes_by_name.controller.provider_ip }}:8776/v3/%(project_id)s <i class="conum" data-value="7"></i><b>(7)</b>
# openstack endpoint create --region {{region}} cinderv3 internal http://{{ nodes_by_name.controller.tunnel_ip }}:8776/v3/%(project_id)s <i class="conum" data-value="8"></i><b>(8)</b>
# openstack endpoint create --region {{region}} cinderv3 admin http://{{ nodes_by_name.controller.management_ip }}:8776/v3/%(project_id)s <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Cinder</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install cinder-api cinder-scheduler</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/cinder/cinder.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/cinder/cinder.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
my_ip = {{ nodes.controller.management_ip }} <i class="conum" data-value="1"></i><b>(1)</b>
glance_api_servers = http://{{ nodes.controller.name }}:9292 <i class="conum" data-value="2"></i><b>(2)</b>
auth_strategy = keystone
enabled_backends = ds1515pV1 <i class="conum" data-value="3"></i><b>(3)</b>
iscsi_helper = tgtadm
iscsi_protocol = iscsi
rpc_backends = rabbit

rabbit_durable_queues = true

[BACKEND]
[BRCD_FABRIC_EXAMPLE]
[CISCO_FABRIC_EXAMPLE]
[COORDINATION]
[FC-ZONE-MANAGER]
[KEY_MANAGER]
[barbican]
[cors]
[cors.subdomain]
[database]
connection = mysql+pymysql://cinder:{{cinder_dbpass}}@{{ nodes.controller.name }}/cinder <i class="conum" data-value="4"></i><b>(4)</b>
[key_manager]
[keystone_authtoken]
auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="5"></i><b>(5)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="6"></i><b>(6)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="7"></i><b>(7)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = {{ cinder_dbpass}} <i class="conum" data-value="8"></i><b>(8)</b>
[matchmaker_redis]
[oslo_concurrency]
lock_path = /var/lock/cinder
[oslo_messaging_amqp]
[oslo_messaging_notifications]
driver = messagingv2
[oslo_messaging_rabbit]
rabbit_host = {{ nodes.controller.name }} <i class="conum" data-value="9"></i><b>(9)</b>
rabbit_userid = openstack
rabbit_password = {{RABBIT_PASS}} <i class="conum" data-value="10"></i><b>(10)</b>
[oslo_messaging_zmq]
[oslo_middleware]
[oslo_policy]
[oslo_reports]
[oslo_versionedobjects]
[ssl]

[ds1515pV1] <i class="conum" data-value="11"></i><b>(11)</b>
volume_backend_name = {{ nas_backend_name }} <i class="conum" data-value="12"></i><b>(12)</b>
volume_driver = cinder.volume.drivers.synology.synology_iscsi.SynoISCSIDriver
iscs_protocol = iscsi
iscsi_ip_address = {{ nas_private_ip }} <i class="conum" data-value="13"></i><b>(13)</b>
synology_admin_port = {{nas_port}} <i class="conum" data-value="14"></i><b>(14)</b>
synology_username = {{nas_user}} <i class="conum" data-value="15"></i><b>(15)</b>
synology_password = {{nas_password}} <i class="conum" data-value="16"></i><b>(16)</b>
synology_pool_name = {{nas_volume}} <i class="conum" data-value="17"></i><b>(17)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Salto a etiqueta personalizada de configuración del NAS para almacenamiento de los volúmenes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña de Cinder y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Contraseña de Cinder</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Contraseña de RabbitMQ</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Etiqueta de bloque personalizada para la configuración del NAS</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Nombre que se da al tipo de volúmenes del NAS en Horizon</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>IP de mantenimiento del NAS</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Puerto de acceso al NAS</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Usuario del NAS</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Contraseña del usuario del NAS</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>Nombre del volumen usado en el NAS</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Inicializar la base de datos <code>cinder</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "cinder-manage db sync" cinder</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios <code>cinder-scheduler</code> y Apache</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service cinder-scheduler restart
# service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar LVM y <code>cinder-volume</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install lvm2
# apt install cinder-volume</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios <code>tgt</code> y <code>cinder-volume</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service tgt restart
# service cinder-volume restart</code></pre>
</div>
</div>
</li>
<li>
<p>Crear el tipo de volumen para el NAS</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack volume type create --public {{ nas_volume_type_name }} <i class="conum" data-value="1"></i><b>(1)</b>
# openstack volume type set --property volume_backend_name={{ nas_backend_name }} {{ nas_volume_type_name }} <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tipo de volumen (p.e. <code>NAS</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre asignado al tipo de volumen (p.e. <code>VOL_NAS</code>)</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueheat"><a class="anchor" href="#trueheat"></a>11. Heat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La instalación de Heat se realiza en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>heat</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">CREATE DATABASE heat;

GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' \
  IDENTIFIED BY 'HEAT_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' \
  IDENTIFIED BY 'HEAT_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Heat</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Heat</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Heat (usuario <code>heat</code>, añadir el usuario <code>heat</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear los servicios <code>heat</code> y <code>heat-cfn</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default heat --password {{ heat_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user heat admin
# openstack service create --name heat --description "Orchestration" orchestration
# openstack service create --name heat-cfn --description "Orchestration" cloudformation</code></pre>
</div>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} orchestration public http://{{ nodes_by_name.controller.provider_ip }}:8004/v1/%(tenant_id)s <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} orchestration internal http://{{ nodes_by_name.controller.tunnel_ip }}:8004/v1/%(tenant_id)s <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} orchestration admin http://{{ nodes_by_name.controller.management_ip }}:8004/v1/%(tenant_id)s <i class="conum" data-value="3"></i><b>(3)</b>

# openstack endpoint create --region {{region}} cloudformation public http://{{ nodes_by_name.controller.provider_ip }}:8000/v1 <i class="conum" data-value="4"></i><b>(4)</b>
# openstack endpoint create --region {{region}} cloudformation internal http://{{ nodes_by_name.controller.tunnel_ip }}:8000/v1 <i class="conum" data-value="5"></i><b>(5)</b>
# openstack endpoint create --region {{region}} cloudformation admin http://{{ nodes_by_name.controller.management_ip }}:8000/v1 <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear roles, dominio y usuario en el dominio necesarios para Heat</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack domain create --description "Stack projects and users" heat
# openstack user create --domain heat --password {{heat_dbpass}} heat_domain_admin
# openstack role add --domain heat --user-domain heat --user heat_domain_admin admin
# openstack role create heat_stack_owner
# openstack role add --project demo --user demo heat_stack_owner
# openstack role create heat_stack_user</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar los paquetes de Heat</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install heat-api heat-api-cfn heat-engine</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/heat/heat.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/heat/heat.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

heat_metadata_server_url = http://{{ nodes.controller.name }}:8000 <i class="conum" data-value="1"></i><b>(1)</b>

heat_waitcondition_server_url = http://{{ nodes.controller.name }}:8000/v1/waitcondition <i class="conum" data-value="2"></i><b>(2)</b>

stack_user_domain_name = heat

stack_domain_admin = heat_domain_admin

stack_domain_admin_password = {{ heat_dbpass }} <i class="conum" data-value="3"></i><b>(3)</b>

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="4"></i><b>(4)</b>

[auth_password]

[clients]

[clients_aodh]

[clients_barbican]

[clients_ceilometer]

[clients_cinder]

[clients_designate]

[clients_glance]

[clients_heat]

[clients_keystone]

auth_uri =  http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="5"></i><b>(5)</b>

[clients_magnum]

[clients_manila]

[clients_mistral]

[clients_monasca]

[clients_neutron]

[clients_nova]

[clients_sahara]

[clients_senlin]

[clients_swift]

[clients_trove]

[clients_zaqar]

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://heat:{{ heat_dbpass }}@{{ nodes.controller.name }}/heat <i class="conum" data-value="6"></i><b>(6)</b>

[ec2authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="7"></i><b>(7)</b>

[eventlet_opts]

[healthcheck]

[heat_api]

[heat_api_cfn]

[heat_api_cloudwatch]

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="8"></i><b>(8)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="9"></i><b>(9)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="10"></i><b>(10)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = heat
password = {{ heat_dbpass}} <i class="conum" data-value="11"></i><b>(11)</b>

[matchmaker_redis]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

driver = messagingv2

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_policy]

[paste_deploy]

[profiler]

[revision]

[ssl]

[trustee]

auth_type = password

auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="12"></i><b>(12)</b>

username = heat

user_domain_name = default

password = {{ heat_dbpass }} <i class="conum" data-value="13"></i><b>(13)</b>

[volumes]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Heat</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña de Cinder y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Contraseña de Heat</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Contraseña de Heat</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Inicializar la base de datos <code>heat</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">su -s /bin/sh -c "heat-manage db_sync" heat</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar servicios de Heat</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service heat-api restart
# service heat-api-cfn restart
# service heat-engine restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truemanila"><a class="anchor" href="#truemanila"></a>12. Manila</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueinstalaci-n-de-manila-en-el-nodo-de-control"><a class="anchor" href="#trueinstalaci-n-de-manila-en-el-nodo-de-control"></a>12.1. Instalación de Manila en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estos pasos en el nodo de control</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>manila</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">CREATE DATABASE manila;

GRANT ALL PRIVILEGES ON manila.* TO 'manila'@'localhost' \
  IDENTIFIED BY 'MANILA_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
GRANT ALL PRIVILEGES ON manila.* TO 'manila'@'%' \
  IDENTIFIED BY 'MANILA_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de Manila</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de Manila</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Manila (usuario <code>manila</code>, añadir el usuario <code>manila</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear los servicios <code>manila</code> y <code>manilav2</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default manila --password {{ manila_dbpass }}
# openstack role add --project service --user manila admin
# openstack service create --name manila --description "OpenStack Shared File Systems" share
# openstack service create --name manilav2 --description "OpenStack Shared File Systems" sharev2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Credenciales del usuario <code>manila</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} share public http://{{ nodes_by_name.controller.provider_ip }}:8786/v1/%\(tenant_id\)s <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} share internal http://{{ nodes_by_name.controller.tunnel_ip }}:8786/v1/%\(tenant_id\)s <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} share admin http://{{ nodes_by_name.controller.management_ip }}:8786/v1/%\(tenant_id\)s <i class="conum" data-value="3"></i><b>(3)</b>

# openstack endpoint create --region {{region}} sharev2 public http://{{ nodes_by_name.controller.provider_ip }}:8786/v2/%\(tenant_id\)s <i class="conum" data-value="4"></i><b>(4)</b>
# openstack endpoint create --region {{region}} sharev2 internal http://{{ nodes_by_name.controller.tunnel_ip }}:8786/v2/%\(tenant_id\)s <i class="conum" data-value="5"></i><b>(5)</b>
# command: openstack endpoint create --region {{region}} sharev2 admin http://{{ nodes_by_name.controller.management_ip }}:8786/v2/%\(tenant_id\)s <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Cinder</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install manila-api manila-scheduler python-manilaclient</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/manila/manila.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/manila/manila.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

rpc_backend = rabbit
rabbit_durable_queues = true

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

default_share_type = default_share_type
share_name_template = share-%s
rootwrap_config = /etc/manila/rootwrap.conf
api_paste_config = /etc/manila/api-paste.ini

auth_strategy = keystone

my_ip = {{ nodes.controller.management_ip }} <i class="conum" data-value="2"></i><b>(2)</b>

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://manila:{{ manila_dbpass }}@{{ nodes.controller.management_ip }}/manila <i class="conum" data-value="3"></i><b>(3)</b>

[keystone_authtoken]

memcached_servers = {{ nodes.controller.management_ip }}:11211 <i class="conum" data-value="4"></i><b>(4)</b>
auth_uri = http://{{ nodes.controller.management_ip }}:5000 <i class="conum" data-value="5"></i><b>(5)</b>
auth_url = http://{{ nodes.controller.management_ip }}:35357 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_id = default
user_domain_id = default
project_name = service
username = manila
password = {{ manila_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_concurrency]
lock_path = /var/lib/manila/tmp</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contraseña de Manila y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Contraseña de Manila</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Inicializar la base de datos <code>manila</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "manila-manage db sync" manila</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar servicios de Manila</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service manila-scheduler restart
# service manila-api restart</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar la base de datos <code>manila.sqlite</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># rm -f /var/lib/manila/manila.sqlite</code></pre>
</div>
</div>
</li>
<li>
<p>Clonar el repositorio de <code>manila-ui</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># git clone https://github.com/openstack/manila-ui /tmp/manila-ui</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Manila no tiene empaquetada la integración con Horizon. En estos casos descargaremos los fuentes del dashboard, los procesaremos y los integraremos en Horizon.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar el dashboard de Manila desde <code>/tmp/manila-ui/</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /tmp/manila-ui/
# python setup.py install</code></pre>
</div>
</div>
</li>
<li>
<p>Copiar los archivos del dashboard de Manila</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cp /tmp/manila-ui/manila_ui/local/enabled/_90_manila*  /usr/share/openstack-dashboard/openstack_dashboard/local/enabled/</code></pre>
</div>
</div>
</li>
<li>
<p>Realizar estos últimos pasos para terminar de integrar el dashboard en Horizon</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /usr/share/openstack-dashboard
# python manage.py collectstatic <i class="conum" data-value="1"></i><b>(1)</b>
# python manage.py compress</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Responder <code>yes</code> a la pregunta</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reiniciar el servidor Apache</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service apache2 restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalaci-n-de-manila-en-el-nodo-de-almacenamiento-compartido"><a class="anchor" href="#trueinstalaci-n-de-manila-en-el-nodo-de-almacenamiento-compartido"></a>12.2. Instalación de Manila en el nodo de almacenamiento compartido</h3>
<div class="paragraph">
<p>Realizar estos pasos en el nodo de almacenamiento compartido</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar Manila en el nodo de almacenamiento compartido</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install manila-share python-pymysql lvm2 nfs-kernel-server</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/manila/manila.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/manila/manila.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.management_ip }} <i class="conum" data-value="1"></i><b>(1)</b>
default_share_type = default_share_type
rootwrap_config = /etc/manila/rootwrap.conf
auth_strategy = keystone
my_ip = {{ nodes_by_name.shared.management_ip }} <i class="conum" data-value="2"></i><b>(2)</b>
enabled_share_backends = lvm
enabled_share_protocols = NFS
rpc_backend = rabbit
rabbit_durable_queues = true
api_paste_config = /etc/manila/api-paste.ini
state_path = /var/lib/manila

[cors]

[cors.subdomain]

[database]

connection = mysql+pymysql://manila:{{ manila_dbpass }}@{{ nodes.controller.management_ip }}/manila <i class="conum" data-value="3"></i><b>(3)</b>

[keystone_authtoken]

memcached_servers = {{nodes.controller.management_ip }}:11211 <i class="conum" data-value="4"></i><b>(4)</b>
auth_uri = http://{{ nodes.controller.management_ip }}:5000 <i class="conum" data-value="5"></i><b>(5)</b>
auth_url = http://{{ nodes.controller.management_ip }}:35357 <i class="conum" data-value="6"></i><b>(6)</b>
auth_type = password
project_domain_id = default
user_domain_id = default
project_name = service
username = manila
password = {{ manila_dbpass }} <i class="conum" data-value="7"></i><b>(7)</b>

[matchmaker_redis]

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_middleware]

[oslo_concurrency]
lock_path = /var/lib/manila/tmp

[lvm]
share_backend_name = LVM
share_driver = manila.share.drivers.lvm.LVMShareDriver
driver_handles_share_servers = False
lvm_share_volume_group = manila-volumes
lvm_share_export_ip = {{ nodes_by_name.shared.provider_ip }} <i class="conum" data-value="8"></i><b>(8)</b>
---
&lt;1&gt; Contraseña de RabbitMQ y dirección IP de mantenimiento del nodo de control
&lt;2&gt; IP de mantenimiento del nodo de almacenamiento compartido
&lt;3&gt; Contraseña de Manila y dirección IP de mantenimiento del nodo de control
&lt;4&gt; IP de mantenemiento del nodo de control
&lt;5&gt; IP de mantenemiento del nodo de control
&lt;6&gt; IP de mantenemiento del nodo de control
&lt;7&gt; Contraseña de Manila
&lt;8&gt; IP externa del nodo de almacenamiento compartido</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Crear el volumen físico LVM</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># pvcreate /dev/{{ shared_storage_device }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Volumen del nodo de almacenamiento compartido dedicado a Manila</td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear el grupo de volúmenes <code>manila-volumes</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># vgcreate manila-volumes /dev/{{ shared_storage_device }} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Volumen del nodo de almacenamiento compartido dedicado a Manila</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/lvm/lvm.conf</code> añadiendo la línea siguiente al bloque <code>devices</code> para especificar los dispositivos utilizados por LVM</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">filter = [ "a/{{ shared_storage_device }}/", "r/.*/"] <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Volumen del nodo de almacenamiento compartido dedicado a Manila</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reiniciar el servicio <code>manila-share</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service manila-share restart</code></pre>
</div>
</div>
</li>
<li>
<p>Activar el servicio <code>nfs-server</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># systemctl enable nfs-server</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar la base de dato manila.sqlite ` en el nodo de almacenamiento compartido.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># rm -f /var/lib/manila/manila.sqlite</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueconfiguraci-n-de-manila-en-el-nodo-de-control"><a class="anchor" href="#trueconfiguraci-n-de-manila-en-el-nodo-de-control"></a>12.3. Configuración de Manila en el nodo de control</h3>
<div class="paragraph">
<p>Realizar esta operación en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear el tipo para volúmenes compartidos con <code>Shared File Systems</code> del tipo <code>DHSS = False</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># manila type-create default_share_type False</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueswift"><a class="anchor" href="#trueswift"></a>13. Swift</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueinstalaci-n-de-swift-en-el-nodo-de-control"><a class="anchor" href="#trueinstalaci-n-de-swift-en-el-nodo-de-control"></a>13.1. Instalación de Swift en el nodo de control</h3>
<div class="paragraph">
<p>Realizar estas operaciones en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Realizar la configuración de Cinder (usuario <code>cinder</code>, añadir el usuario <code>cinder</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear los servicios <code>cinder</code>, <code>cinderv2</code> y <code>cinderv3</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default swift --password {{ swift_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user swift admin
# openstack service create --name swift --description "OpenStack Object Storage" object-store</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>swift</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} object-store public http://{{ nodes_by_name.controller.provider_ip }}:8080/v1/AUTH_%\(tenant_id\)s <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} object-store internal http://{{ nodes_by_name.controller.tunnel_ip }}:8080/v1/AUTH_%\(tenant_id\)s <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} object-store admin http://{{ nodes_by_name.controller.management_ip }}:8080/v1/AUTH_%\(tenant_id\)s <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Swift</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install swift swift-proxy python-swiftclient python-keystoneclient python-keystonemiddleware</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/swift/proxy-server.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/swift/proxy-server.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
bind_port = 8080
swift_dir = /etc/swift
user = swift

[pipeline:main]
pipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server

[app:proxy-server]
use = egg:swift#proxy
account_autocreate = True

[filter:tempauth]
use = egg:swift#tempauth

user_admin_admin = admin .admin .reseller_admin
user_test_tester = testing .admin
user_test2_tester2 = testing2 .admin
user_test_tester3 = testing3
user_test5_tester5 = testing5 service

[filter:authtoken]
paste.filter_factory = keystonemiddleware.auth_token:filter_factory

auth_uri = http://{{ nodes.controller.name }}:5000 <i class="conum" data-value="1"></i><b>(1)</b>
auth_url = http://{{ nodes.controller.name }}:35357 <i class="conum" data-value="2"></i><b>(2)</b>
memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="3"></i><b>(3)</b>
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = swift
password = {{ swift_dbpass}} <i class="conum" data-value="4"></i><b>(4)</b>

delay_auth_decision = True
[filter:keystoneauth]
use = egg:swift#keystoneauth
operator_roles = admin, user

[filter:healthcheck]
use = egg:swift#healthcheck

[filter:cache]
use = egg:swift#memcache
memcache_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="5"></i><b>(5)</b>

[filter:ratelimit]
use = egg:swift#ratelimit

[filter:domain_remap]
use = egg:swift#domain_remap

[filter:catch_errors]
use = egg:swift#catch_errors

[filter:cname_lookup]
use = egg:swift#cname_lookup

[filter:staticweb]
use = egg:swift#staticweb

[filter:tempurl]
use = egg:swift#tempurl

[filter:formpost]
use = egg:swift#formpost

[filter:name_check]
use = egg:swift#name_check

[filter:list-endpoints]
use = egg:swift#list_endpoints

[filter:proxy-logging]
use = egg:swift#proxy_logging

[filter:bulk]
use = egg:swift#bulk

[filter:slo]
use = egg:swift#slo

[filter:dlo]
use = egg:swift#dlo

[filter:container-quotas]
use = egg:swift#container_quotas

[filter:account-quotas]
use = egg:swift#account_quotas

[filter:gatekeeper]
use = egg:swift#gatekeeper

[filter:container_sync]
use = egg:swift#container_sync

[filter:xprofile]
use = egg:swift#xprofile

[filter:versioned_writes]
use = egg:swift#versioned_writes

[filter:copy]
use = egg:swift#copy

[filter:keymaster]
use = egg:swift#keymaster

encryption_root_secret = changeme

[filter:encryption]
use = egg:swift#encryption

[filter:ceilometer]
paste.filter_factory = ceilometermiddleware.swift:filter_factory

control_exchange = swift
url = rabbit://openstack:{{ RABBIT_PASS }}@{{ short_controller_name }}:5672/ <i class="conum" data-value="6"></i><b>(6)</b>
driver = messagingv2
topic = notifications
log_level = WARN</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contraseña de Swift</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Cambiar el propietario del directorio <code>/etc/swift</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># chown -R root:swift /etc/swift</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalar-swift-en-nodos-de-almacenamiento-de-objetos"><a class="anchor" href="#trueinstalar-swift-en-nodos-de-almacenamiento-de-objetos"></a>13.2. Instalar Swift en nodos de almacenamiento de objetos</h3>
<div class="paragraph">
<p>Realizar estas operaciones en los nodos de almacenamiento de objetos.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar los paquetes de soporte</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install xfsprogs rsync</code></pre>
</div>
</div>
</li>
<li>
<p>Crear particiones</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># fdisk /dev/sdb
# fdisk /dev/sdc</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En este tutorial suponemos que cada uno de los servidores dedicados a almacenamiento de objetos cuentan con 2 discos (<code>sdb</code> y <code>sdc</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Formatear discos en formato <code>xfs</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># mkfs.xfs /dev/sdb1
# mkfs.xfs /dev/sdc1</code></pre>
</div>
</div>
</li>
<li>
<p>Crear los puntos de montaje</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># mkdir -p /srv/node/sdb
# mkdir -p /srv/node/sdc</code></pre>
</div>
</div>
</li>
<li>
<p>Montar los discos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># mount /dev/sdb1 /srv/node/sdb
# mount /dev/sdc1 /srv/node/sdc</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/rsyncd.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/rsync.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">uid = swift
gid = swift
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
address = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>

[account]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/account.lock

[container]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/container.lock

[object]
max connections = 2
path = /srv/node/
read only = False
lock file = /var/lock/object.lock</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de almacenamiento de objetos</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Activar <code>rsync</code> en <code>/etc/default/rsync</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">RSYNC_ENABLE=true <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Establecer este valor</td>
</tr>
</table>
</div>
</li>
<li>
<p>Iniciar <code>rsync</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service rsync start</code></pre>
</div>
</div>
</li>
<li>
<p>Instalar los paquetes de Swift en los nodos de almacenamiento de objetos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install swift swift-account swift-container swift-object</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/swift/account-server.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/swift/account-server.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
bind_ip = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>
bind_port = 6202
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = true

[pipeline:main]
pipeline = healthcheck recon account-server

[app:account-server]
use = egg:swift#account

[filter:healthcheck]
use = egg:swift#healthcheck

[filter:recon]
use = egg:swift#recon
recon_cache_path = /var/cache/swift

[account-replicator]

[account-auditor]

[account-reaper]

[filter:xprofile]
use = egg:swift#xprofile</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de almacenamiento de objetos</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/swift/container-server.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/swift/container-server.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
bind_ip = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>
bind_port = 6201
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = true

[pipeline:main]
pipeline = healthcheck recon container-server

[app:container-server]
use = egg:swift#container

[filter:healthcheck]
use = egg:swift#healthcheck

[filter:recon]
use = egg:swift#recon
recon_cache_path = /var/cache/swift

[container-replicator]

[container-updater]

[container-auditor]

[container-sync]

[filter:xprofile]
use = egg:swift#xprofile</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de almacenamiento de objetos</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/swift/object-server.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/swift/object-server.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]
bind_ip = {{ ansible_eth0.ipv4.address }} <i class="conum" data-value="1"></i><b>(1)</b>
bind_port = 6200
user = swift
swift_dir = /etc/swift
devices = /srv/node
mount_check = true

[pipeline:main]
pipeline = healthcheck recon object-server

[app:object-server]
use = egg:swift#object

[filter:healthcheck]
use = egg:swift#healthcheck

[filter:recon]
use = egg:swift#recon
recon_cache_path = /var/cache/swift
recon_lock_path = /var/lock

[object-replicator]

[object-reconstructor]

[object-updater]

[object-auditor]

[filter:xprofile]
use = egg:swift#xprofile</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del nodo de almacenamiento de objetos</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Crear el directorio <code>/srv/node</code> si no existe y cambiarlo de propietario</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># mkdir -p /srv/node
# chown -R swift:swift /srv/node</code></pre>
</div>
</div>
</li>
<li>
<p>Crear el directorio <code>/var/cache/swift</code> si no existe y cambiarlo de propietario</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># mkdir -p /var/cache/swift
# chown -R root:swift /var/cache/swift</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="truecrear-y-distribuir-los-anillos-iniciales"><a class="anchor" href="#truecrear-y-distribuir-los-anillos-iniciales"></a>13.3. Crear y distribuir los anillos iniciales</h3>
<div class="paragraph">
<p>Realizar estas operaciones en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear el archivo base <code>account.builder</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder account.builder create 10 3 1</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir cada nodo de almacenamiento al anillo. Añade el anillo para la combinación de los dos nodos de almacenamiento de objetos (<code>objetos01</code> y <code>objetos02</code>) con los dos dispositivos (<code>sdb</code> y <code>sdc</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder account.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \ <i class="conum" data-value="1"></i><b>(1)</b>
    --port 6202 --device {{ sdb }}  \ <i class="conum" data-value="2"></i><b>(2)</b>
    --weight 100} <i class="conum" data-value="3"></i><b>(3)</b>
# swift-ring-builder account.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}

# swift-ring-builder account.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdb }}  \
    --weight 100}
# swift-ring-builder account.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del primer nodo de almacenamiento de objetos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Primer dispositivo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El peso lo inicializamos a 100</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebalancear el anillo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder account.builder rebalance</code></pre>
</div>
</div>
</li>
<li>
<p>Crear el archivo base <code>container.builder</code>. Añade el anillo para la combinación de los dos nodos de almacenamiento de objetos (<code>objetos01</code> y <code>objetos02</code>) con los dos dispositivos (<code>sdb</code> y <code>sdc</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>swift-ring-builder container.builder create 10 3 1</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir cada nodo de almacenamiento al anillo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder container.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \ <i class="conum" data-value="1"></i><b>(1)</b>
    --port 6202 --device {{ sdb }}  \ <i class="conum" data-value="2"></i><b>(2)</b>
    --weight 100} <i class="conum" data-value="3"></i><b>(3)</b>
# swift-ring-builder container.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}

# swift-ring-builder container.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdb }}  \
    --weight 100}
# swift-ring-builder container.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del primer nodo de almacenamiento de objetos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Primer dispositivo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El peso lo inicializamos a 100</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebalancear el anillo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder container.builder rebalance</code></pre>
</div>
</div>
</li>
<li>
<p>Crear el archivo base <code>object.builder</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder object.builder create 10 3 1</code></pre>
</div>
</div>
</li>
<li>
<p>Añadir cada nodo de almacenamiento al anillo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder object.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \ <i class="conum" data-value="1"></i><b>(1)</b>
    --port 6202 --device {{ sdb }}  \ <i class="conum" data-value="2"></i><b>(2)</b>
    --weight 100} <i class="conum" data-value="3"></i><b>(3)</b>
# swift-ring-builder object.builder add --region 1 --zone 1 --ip {{ objetos01.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}

# swift-ring-builder object.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdb }}  \
    --weight 100}
# swift-ring-builder object.builder add --region 1 --zone 1 --ip {{ objetos02.management_ip}}  \
    --port 6202 --device {{ sdc }} \
    --weight 100}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimiento del primer nodo de almacenamiento de objetos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Primer dispositivo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El peso lo inicializamos a 100</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebalancear el anillo</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># swift-ring-builder object.builder rebalance</code></pre>
</div>
</div>
</li>
<li>
<p>Distribuir los archivos de configuración del anillo a los nodos de almacenamiento de objetos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># scp /etc/swift/*.ring.gz {{ objetos01.management_ip }}:/etc/swift <i class="conum" data-value="1"></i><b>(1)</b>
# scp /etc/swift/*.ring.gz {{ objetos02.management_ip }}:/etc/swift <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>IP de mantenimento del nodo 1 de almacenamiento de objetos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>IP de mantenimento del nodo 2 de almacenamiento de objetos</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="truemodificar-la-configuraci-n-de-swift"><a class="anchor" href="#truemodificar-la-configuraci-n-de-swift"></a>13.4. Modificar la configuración de Swift</h3>
<div class="paragraph">
<p>Realizar estas operaciones en el nodo de control y en los nodos de almacenamiento de objetos</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modificar el archivo <code>/etc/swift/swift.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/swift/swift.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[swift-hash]

swift_hash_path_suffix = {{ hash_path_suffix }} <i class="conum" data-value="1"></i><b>(1)</b>
swift_hash_path_prefix = {{ hash_path_prefix }} <i class="conum" data-value="2"></i><b>(2)</b>

[storage-policy:0]
name = Policy-0
default = yes
aliases = yellow, orange

[swift-constraints]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prefijo secreto de hash</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sufijo secreto de hash</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Cambiar el propietario del directorio <code>/etc/swift</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># chown -R root:swift /etc/swift</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueiniciar-y-reiniciar-servicios"><a class="anchor" href="#trueiniciar-y-reiniciar-servicios"></a>13.5. Iniciar y reiniciar servicios</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reiniciar servicios en nodo de control</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service memcached restart
# service swift-proxy restart</code></pre>
</div>
</div>
</li>
<li>
<p>Iniciar los servicios de almacenamiento en los nodos de almacenamiento de objetos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># swift-init all start</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truesahara"><a class="anchor" href="#truesahara"></a>14. Sahara</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Realizar todos estos pasos en el nodo de control.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creación y configuración de la base de datos <code>sahara</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">MariaDB [(none)]&gt; CREATE DATABASE sahara;

MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON sahara.* TO 'sahara'@'localhost' \
  IDENTIFIED BY 'SAHARA_DBPASS'; <i class="conum" data-value="1"></i><b>(1)</b>
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON sahara.* TO 'sahara'@'%' \
  IDENTIFIED BY 'SAHARA_DBPASS'; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña del usuario Sahara</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario Sahara</td>
</tr>
</table>
</div>
</li>
<li>
<p>Realizar la configuración de Sahara (usuario <code>sahara</code>, añadir el usuario <code>sahara</code> al proyecto <code>service</code> con el rol <code>admin</code> y crear el servicio <code>sahara</code>)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># source openrc-admin <i class="conum" data-value="1"></i><b>(1)</b>

# openstack user create --domain default sahara --password {{ sahara_dbpass }} <i class="conum" data-value="2"></i><b>(2)</b>
# openstack role add --project service --user sahara admin
# openstack service create --name sahara --description "OpenStack Data Processing" data-processing</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cargar las credenciales de <code>admin</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña del usuario <code>sahara</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear los endpoints de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># openstack endpoint create --region {{region}} data-processing public http://{{ nodes_by_name.controller.provider_ip }}:8386/v1.1/%\(project_id\)s <i class="conum" data-value="1"></i><b>(1)</b>
# openstack endpoint create --region {{region}} data-processing internal http://{{ nodes_by_name.controller.tunnel_ip }}:8386/v1.1/%\(project_id\)s <i class="conum" data-value="2"></i><b>(2)</b>
# openstack endpoint create --region {{region}} data-processing admin http://{{ nodes_by_name.controller.management_ip }}:8386/v1.1/%\(project_id\)s <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP externa del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de túnel del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Región (p.e, <code>RegionOne</code>) e IP de mantenimiento del nodo de control</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar los paquetes de Glance</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># apt install sahara python-saharaclient</code></pre>
</div>
</div>
</li>
<li>
<p>Configurar el archivo <code>/etc/sahara/sahara.conf</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/etc/sahara/sahara.conf</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[DEFAULT]

transport_url = rabbit://openstack:{{ RABBIT_PASS }}@{{ nodes.controller.name }} <i class="conum" data-value="1"></i><b>(1)</b>

use_floating_ips = true

use_neutron = true

heat_enable_wait_condition = false

[castellan]

[cinder]

[conductor]

[cors]

[cors.subdomain]

[database]

connection = mysql://sahara:{{ sahara_dbpass }}@{{ nodes.controller.name }}/sahara <i class="conum" data-value="2"></i><b>(2)</b>

[heat]

[keystone]

[keystone_authtoken]

auth_uri = http://{{ nodes.controller.name }}:5000/v3/ <i class="conum" data-value="3"></i><b>(3)</b>

memcached_servers = {{ nodes.controller.name }}:11211 <i class="conum" data-value="4"></i><b>(4)</b>

identity_uri = http://{{ nodes.controller.name }}:35357/ <i class="conum" data-value="5"></i><b>(5)</b>

admin_user = sahara

admin_password = {{ sahara_dbpass }} <i class="conum" data-value="6"></i><b>(6)</b>

admin_tenant_name = service

[matchmaker_redis]

[neutron]

[nova]

[object_store_access]

[oslo_concurrency]

lock_path = /var/lock/sahara

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]

[oslo_messaging_zmq]

[oslo_policy]

[retries]

[ssl]

[swift]

[timeouts]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contraseña de RabbitMQ y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contraseña de Sahara y nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Nombre del nodo de control</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Contraseña de Sahara</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Añadir lo siguiente a <code>/etc/mysql/my.cnf</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[mysqld]
max_allowed_packet = 256M</code></pre>
</div>
</div>
</li>
<li>
<p>Reiniciar MySQL</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service mysql restart</code></pre>
</div>
</div>
</li>
<li>
<p>Inicializar la base de datos <code>sahara</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># su -s /bin/sh -c "sahara-db-manage --config-file /etc/sahara/sahara.conf upgrade head" sahara</code></pre>
</div>
</div>
</li>
<li>
<p>Modificar el archivo <code>/usr/lib/python2.7/dist-packages/sahara/service/quotas.py</code></p>
<div class="sidebarblock">
<div class="content">
<div class="title">El archivo <code>/usr/lib/python2.7/dist-packages/sahara/service/quotas.py</code></div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">from oslo_config import cfg
import six

from sahara import context
from sahara import exceptions as ex
from sahara.i18n import _
from sahara.utils.openstack import base as b
from sahara.utils.openstack import cinder as cinder_client
from sahara.utils.openstack import neutron as neutron_client
from sahara.utils.openstack import nova as nova_client

CONF = cfg.CONF

UNLIMITED = 'unlimited'

def _is_unlimited(limit):
    return limit == -1

def _get_zero_limits():
    return {
        'ram': 0,
        'cpu': 0,
        'instances': 0,
        'floatingips': 0,
        'security_groups': 0,
        'security_group_rules': 0,
        'ports': 0,
        'volumes': 0,
        'volume_gbs': 0
    }

def check_cluster(cluster):
    req_limits = _get_req_cluster_limits(cluster)
    _check_limits(req_limits)

def check_scaling(cluster, to_be_enlarged, additional):
    req_limits = _get_req_scaling_limits(cluster, to_be_enlarged, additional)
    _check_limits(req_limits)

def _check_limits(req_limits):
    limits_name_map = {
        'ram': _("RAM"),
        'cpu': _("VCPU"),
        'instances': _("instance"),
        'floatingips': _("floating ip"),
        'security_groups': _("security group"),
        'security_group_rules': _("security group rule"),
        'ports': _("port"),
        'volumes': _("volume"),
        'volume_gbs': _("volume storage")
    }

    avail_limits = _get_avail_limits()
    for quota, quota_name in six.iteritems(limits_name_map):
        if avail_limits[quota] != UNLIMITED:
            if avail_limits[quota] &lt; req_limits[quota]:
                raise ex.QuotaException(quota_name, req_limits[quota],
                                        avail_limits[quota])

def _get_req_cluster_limits(cluster):
    req_limits = _get_zero_limits()
    for ng in cluster.node_groups:
        _update_limits_for_ng(req_limits, ng, ng.count)
    return req_limits

def _get_req_scaling_limits(cluster, to_be_enlarged, additional):
    ng_id_map = to_be_enlarged.copy()
    ng_id_map.update(additional)
    req_limits = _get_zero_limits()
    for ng in cluster.node_groups:
        if ng_id_map.get(ng.id):
            _update_limits_for_ng(req_limits, ng, ng_id_map[ng.id] - ng.count)
    return req_limits

def _update_limits_for_ng(limits, ng, count):
    sign = lambda x: (1, -1)[x &lt; 0]
    nova = nova_client.client()
    limits['instances'] += count
    flavor = b.execute_with_retries(nova.flavors.get, ng.flavor_id)
    limits['ram'] += flavor.ram * count
    limits['cpu'] += flavor.vcpus * count
    # tmckay-fp this is fine, it will be zero without it
    if ng.floating_ip_pool:
        limits['floatingips'] += count
    if ng.volumes_per_node:
        limits['volumes'] += ng.volumes_per_node * count
        limits['volume_gbs'] += ng.volumes_per_node * ng.volumes_size * count
    if ng.auto_security_group:
        limits['security_groups'] += sign(count)
        # NOTE: +3 - all traffic for private network
        if CONF.use_neutron:
            limits['security_group_rules'] += (
                (len(ng.open_ports) + 3) * sign(count))
        else:
            limits['security_group_rules'] = max(
                limits['security_group_rules'], len(ng.open_ports) + 3)
    if CONF.use_neutron:
        limits['ports'] += count

def _get_avail_limits():
    limits = _get_zero_limits()
    limits.update(_get_nova_limits())
    limits.update(_get_neutron_limits())
    if cinder_client.check_cinder_exists():
        limits.update(_get_cinder_limits())
    return limits

def _sub_limit(total, used):
    if _is_unlimited(total):
        return UNLIMITED
    else:
        return total - used

def _get_nova_limits():
    limits = {}
    nova = nova_client.client()
    lim = b.execute_with_retries(nova.limits.get).to_dict()['absolute']
    limits['ram'] = _sub_limit(lim['maxTotalRAMSize'], lim['totalRAMUsed'])
    limits['cpu'] = _sub_limit(lim['maxTotalCores'], lim['totalCoresUsed'])
    limits['instances'] = _sub_limit(lim['maxTotalInstances'],
                                     lim['totalInstancesUsed'])
    if CONF.use_neutron:
        return limits

    # tmckay-fp here we would just get the limits all the time
    limits['floatingips'] = _sub_limit(lim['maxTotalFloatingIps'],
                                       lim['totalFloatingIpsUsed'])
    # limits['floatingips'] = 0

    limits['security_groups'] = _sub_limit(lim['maxSecurityGroups'],
                                           lim['totalSecurityGroupsUsed'])
    limits['security_group_rules'] = _sub_limit(lim['maxSecurityGroupRules'],
                                                0)
    return limits

def _get_neutron_limits():
    limits = {}
    if not CONF.use_neutron:
        return limits
    neutron = neutron_client.client()
    tenant_id = context.ctx().tenant_id
    total_lim = b.execute_with_retries(neutron.show_quota, tenant_id)['quota']

    # tmckay-fp here we would just get the limits all the time
    usage_fip = b.execute_with_retries(
       neutron.list_floatingips,  tenant_id=tenant_id)['floatingips']
    limits['floatingips'] = _sub_limit(total_lim['floatingip'],
                                      len(usage_fip))
    # limits['floatingips'] = 0

    usage_sg = b.execute_with_retries(
        neutron.list_security_groups, tenant_id=tenant_id).get(
        'security_groups', [])
    limits['security_groups'] = _sub_limit(total_lim['security_group'],
                                           len(usage_sg))

    usage_sg_rules = b.execute_with_retries(
        neutron.list_security_group_rules, tenant_id=tenant_id).get(
        'security_group_rules', [])
    limits['security_group_rules'] = _sub_limit(
        total_lim['security_group_rule'], len(usage_sg_rules))

    usage_ports = b.execute_with_retries(
        neutron.list_ports, tenant_id=tenant_id)['ports']
    limits['ports'] = _sub_limit(total_lim['port'], len(usage_ports))

    return limits

def _get_cinder_limits():
    avail_limits = {}
    cinder = cinder_client.client()
    lim = {}
    for l in b.execute_with_retries(cinder.limits.get).absolute:
        lim[l.name] = l.value

    avail_limits['volumes'] = _sub_limit(lim['maxTotalVolumes'],
                                         lim['totalVolumesUsed'])

    avail_limits['volume_gbs'] = _sub_limit(lim['maxTotalVolumeGigabytes'],
                                            lim['totalGigabytesUsed'])

    return avail_limits</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Reiniciar los servicios de Sahara</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service sahara-api restart
# service sahara-engine restart</code></pre>
</div>
</div>
</li>
<li>
<p>Clonar el repositorio de <code>sahara-dashboard</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># git clone https://github.com/openstack/sahara-dashboard /tmp/sahara-dashboard</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sahara no tiene empaquetada la integración con Horizon. En estos casos descargaremos los fuentes del dashboard, los procesaremos y los integraremos en Horizon.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Instalar el dashboard de Sahara desde <code>/tmp/sahara-dashboard/</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /tmp/sahara-dashboard/
# python setup.py install</code></pre>
</div>
</div>
</li>
<li>
<p>Copiar los archivos del dashboard de Sahara</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cp /tmp/sahara-dashboard/sahara_dashboard/enabled/_1810_data_processing_panel_group.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
# cp /tmp/sahara-dashboard/sahara_dashboard/enabled/_1830_data_processing_plugins_panel.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
# cp /tmp/sahara-dashboard/sahara_dashboard/enabled/_1820_data_processing_clusters_panel.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
# cp /tmp/sahara-dashboard/sahara_dashboard/enabled/_1840_data_processing_jobs_panel.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/</code></pre>
</div>
</div>
</li>
<li>
<p>Realizar estos últimos pasos para terminar de integrar el dashboard en Horizon</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># cd /usr/share/openstack-dashboard
# python manage.py collectstatic <i class="conum" data-value="1"></i><b>(1)</b>
# python manage.py compress</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Responder <code>yes</code> a la pregunta</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reiniciar el servidor Apache</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># service apache2 restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueanexo-1-esquema-de-red"><a class="anchor" href="#trueanexo-1-esquema-de-red"></a>Anexo 1. Esquema de red</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/Conexiones.png" alt="Conexiones.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueanexo-2-paquetes-y-archivos-de-configuraci-n"><a class="anchor" href="#trueanexo-2-paquetes-y-archivos-de-configuraci-n"></a>Anexo 2. Paquetes y archivos de configuración</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La instalación de OpenStack es un proceso farragoso en cuanto a la cantidad de paquetes y archivos de configuración que hay que instalar y configuirar en cada tipo de nodo. A continuación se muestran dos figuras que ilustran los paquetes a instalar y los archivos a configurar en cada nodo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/OpenStackPackagesAndFilesController.png" alt="OpenStackPackagesAndFilesController.png">
</div>
<div class="title">Figure 3. Paquetes y archivos a configurar en el nodo de control</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/OpenStackPackagesAndFilesRemainder.png" alt="OpenStackPackagesAndFilesRemainder.png">
</div>
<div class="title">Figure 4. Paquetes y archivos a configurar en el resto de nodos</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueanexo-3-servicios-en-ejecuci-n-en-cada-servidor"><a class="anchor" href="#trueanexo-3-servicios-en-ejecuci-n-en-cada-servidor"></a>Anexo 3. Servicios en ejecución en cada servidor</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Servicios en el nodo de control</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>mysql</code></p>
</li>
<li>
<p><code>rabbitmq</code></p>
</li>
<li>
<p><code>memcached</code></p>
</li>
<li>
<p><code>apache2</code></p>
</li>
<li>
<p><code>glance-api</code>: Discovery, recuperación y almacenamiento de imágenes.</p>
</li>
<li>
<p><code>glance-registry</code>: Creación, modificación y consulta de metadatos de las imágenes (p.e. tamaño, tipo)</p>
</li>
<li>
<p><code>nova-api</code></p>
</li>
<li>
<p><code>nova-placement-api</code>: Inventario y uso de cada provider.</p>
</li>
<li>
<p><code>nova-scheduler</code>: Gestiona peticiones de máquinas virtuales a los nodos de cómputo.</p>
</li>
<li>
<p><code>nova-consoleauth</code>: Da tokens de acceso a los usuarios</p>
</li>
<li>
<p><code>nova-novncproxy</code>: Acceso VNC a las instancias (clientes VNC basados en navegadores compatibles).</p>
</li>
<li>
<p><code>neutron-server</code>: Acepta y emite peticiones a la API del plugin correspondiente (bridging/switching, DHCP, &#8230;&#8203;)</p>
</li>
<li>
<p><code>ml2-agent</code>: Bridging/switching</p>
</li>
<li>
<p><code>cinder-api</code></p>
</li>
<li>
<p><code>cinder-scheduler</code>: Gestiona peticiones de almacenamiento de bloques.</p>
</li>
<li>
<p><code>manila-api</code></p>
</li>
<li>
<p><code>manila-scheduler</code>: Gestiona peticiones de almacenamiento de archivos</p>
</li>
<li>
<p><code>swift-proxy</code></p>
</li>
<li>
<p><code>heat-api</code></p>
</li>
<li>
<p><code>heat-engine</code></p>
</li>
<li>
<p><code>heat-api-ctn</code></p>
</li>
<li>
<p><code>barbican-keystone-listener</code></p>
</li>
<li>
<p><code>barbican-worker</code></p>
</li>
<li>
<p><code>sabana-api</code></p>
</li>
<li>
<p><code>sabana-engine</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Servicios en el nodo de red</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>openvswitch-agent</code>: Bridging/switching para redes virtuales.</p>
</li>
<li>
<p><code>dhcp-agent</code>: Servicios de DHCP para redes virrtuales.</p>
</li>
<li>
<p>`metadata-agent`Servicios de metadatos a las instancias.</p>
</li>
<li>
<p><code>l3-agent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Servicios en nodos de cómputo</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>nova-compute</code>: Crea y termina máquinas virtuales a través de la API del hipervisor</p>
</li>
<li>
<p><code>openvswitch-agent</code>: Bridging/switching para redes virtuales.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Servicios en el nodo de almacenamiento de bloques</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>cinder-volume</code></p>
</li>
<li>
<p><code>lvm2</code></p>
</li>
<li>
<p><code>tgt</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Servicios en el nodo de almacenamiento de archivos compartidos</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>manila-share</code></p>
</li>
<li>
<p><code>lvm2</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Servicios en el nodo de almacenamiento de objetos</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>swift-account</code></p>
</li>
<li>
<p><code>swift-account-auditor</code></p>
</li>
<li>
<p><code>swift-account-reaper</code></p>
</li>
<li>
<p><code>swift-account-replicator</code></p>
</li>
<li>
<p><code>swift-container</code></p>
</li>
<li>
<p><code>swift-container-auditor</code></p>
</li>
<li>
<p><code>swift-container-replicator</code></p>
</li>
<li>
<p><code>swift-container-sync</code></p>
</li>
<li>
<p><code>swift-container-updater</code></p>
</li>
<li>
<p><code>swift-object</code></p>
</li>
<li>
<p><code>swift-object-auditor</code></p>
</li>
<li>
<p><code>swift-object-reconstructor</code></p>
</li>
<li>
<p><code>swift-object-replicator</code></p>
</li>
<li>
<p><code>swift-object-updater</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueanexo-4-tablas-no-vac-as-de-las-bases-de-datos-de-openstack"><a class="anchor" href="#trueanexo-4-tablas-no-vac-as-de-las-bases-de-datos-de-openstack"></a>Anexo 4. Tablas no vacías de las bases de datos de OpenStack</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+--------------------+----------------------------------------------------+
| table_schema       | table_name                                         |
+--------------------+----------------------------------------------------+
| barbican           | alembic_version                                    |
| barbican           | certificate_authorities                            |
| barbican           | certificate_authority_metadata                     |
| barbican           | container_secret                                   |
| barbican           | containers                                         |
| barbican           | encrypted_data                                     |
| barbican           | secret_store_metadata                              |
| barbican           | secrets                                            |
| cinder             | messages                                           |
| cinder             | quota_classes                                      |
| cinder             | quota_usages                                       |
| cinder             | quotas                                             |
| cinder             | reservations                                       |
| cinder             | services                                           |
| cinder             | snapshot_metadata                                  |
| cinder             | snapshots                                          |
| cinder             | transfers                                          |
| cinder             | volume_admin_metadata                              |
| cinder             | volume_attachment                                  |
| cinder             | volume_glance_metadata                             |
| cinder             | volume_metadata                                    |
| cinder             | volumes                                            |
| cinder             | workers                                            |
| glance             | alembic_version                                    |
| glance             | image_locations                                    |
| glance             | image_properties                                   |
| glance             | images                                             |
| heat               | event                                              |
| heat               | raw_template                                       |
| heat               | raw_template_files                                 |
| heat               | resource                                           |
| heat               | resource_data                                      |
| heat               | resource_properties_data                           |
| heat               | service                                            |
| heat               | software_config                                    |
| heat               | stack                                              |
| heat               | user_creds                                         |
| keystone           | assignment                                         |
| keystone           | credential                                         |
| keystone           | endpoint                                           |
| keystone           | local_user                                         |
| keystone           | migrate_version                                    |
| keystone           | password                                           |
| keystone           | project                                            |
| keystone           | revocation_event                                   |
| keystone           | role                                               |
| keystone           | service                                            |
| keystone           | trust                                              |
| keystone           | trust_role                                         |
| keystone           | user                                               |
| manila             | alembic_version                                    |
| manila             | quota_usages                                       |
| manila             | quotas                                             |
| manila             | reservations                                       |
| manila             | services                                           |
| manila             | share_instance_export_locations                    |
| manila             | share_instance_export_locations_metadata           |
| manila             | share_instances                                    |
| manila             | shares                                             |
| neutron            | agents                                             |
| neutron            | alembic_version                                    |
| neutron            | alembic_version_fwaas                              |
| neutron            | alembic_version_lbaas                              |
| neutron            | default_security_group                             |
| neutron            | dnsnameservers                                     |
| neutron            | floatingips                                        |
| neutron            | ipallocationpools                                  |
| neutron            | ipallocations                                      |
| neutron            | ipamallocationpools                                |
| neutron            | ipamallocations                                    |
| neutron            | ipamsubnets                                        |
| neutron            | lbaas_healthmonitors                               |
| neutron            | lbaas_listeners                                    |
| neutron            | lbaas_loadbalancer_statistics                      |
| neutron            | lbaas_loadbalanceragentbindings                    |
| neutron            | lbaas_loadbalancers                                |
| neutron            | lbaas_members                                      |
| neutron            | lbaas_pools                                        |
| neutron            | ml2_port_binding_levels                            |
| neutron            | ml2_port_bindings                                  |
| neutron            | ml2_vxlan_allocations                              |
| neutron            | ml2_vxlan_endpoints                                |
| neutron            | networkdhcpagentbindings                           |
| neutron            | networkrbacs                                       |
| neutron            | networks                                           |
| neutron            | networksecuritybindings                            |
| neutron            | networksegments                                    |
| neutron            | ports                                              |
| neutron            | portsecuritybindings                               |
| neutron            | providerresourceassociations                       |
| neutron            | provisioningblocks                                 |
| neutron            | quotas                                             |
| neutron            | quotausages                                        |
| neutron            | router_extra_attributes                            |
| neutron            | routerl3agentbindings                              |
| neutron            | routerports                                        |
| neutron            | routers                                            |
| neutron            | securitygroupportbindings                          |
| neutron            | securitygrouprules                                 |
| neutron            | securitygroups                                     |
| neutron            | standardattributes                                 |
| neutron            | subnets                                            |
| nova               | block_device_mapping                               |
| nova               | compute_nodes                                      |
| nova               | instance_actions                                   |
| nova               | instance_actions_events                            |
| nova               | instance_extra                                     |
| nova               | instance_faults                                    |
| nova               | instance_id_mappings                               |
| nova               | instance_info_caches                               |
| nova               | instance_metadata                                  |
| nova               | instance_system_metadata                           |
| nova               | instances                                          |
| nova               | migrations                                         |
| nova               | quota_usages                                       |
| nova               | quotas                                             |
| nova               | reservations                                       |
| nova               | s3_images                                          |
| nova               | security_groups                                    |
| nova               | services                                           |
| nova               | task_log                                           |
| nova               | virtual_interfaces                                 |
| nova_api           | allocations                                        |
| nova_api           | cell_mappings                                      |
| nova_api           | flavor_projects                                    |
| nova_api           | flavors                                            |
| nova_api           | host_mappings                                      |
| nova_api           | instance_group_member                              |
| nova_api           | instance_group_policy                              |
| nova_api           | instance_groups                                    |
| nova_api           | instance_mappings                                  |
| nova_api           | inventories                                        |
| nova_api           | key_pairs                                          |
| nova_api           | request_specs                                      |
| nova_api           | resource_providers                                 |
| nova_cell0         | instance_extra                                     |
| nova_cell0         | instance_faults                                    |
| nova_cell0         | instance_id_mappings                               |
| nova_cell0         | instance_info_caches                               |
| nova_cell0         | instance_system_metadata                           |
| nova_cell0         | instances                                          |
| nova_cell0         | quota_usages                                       |
| nova_cell0         | s3_images                                          |
| nova_cell0         | security_groups                                    |
| sahara             | alembic_version                                    |
+--------------------+----------------------------------------------------+</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueanexo-5-consultas-sql-de-utilidad"><a class="anchor" href="#trueanexo-5-consultas-sql-de-utilidad"></a>Anexo 5. Consultas SQL de utilidad</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ids de proyectos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">= SELECT id
FROM keystone.project
WHERE name IN ('proyecto1', 'proyecto2'); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pasar los nombre de proyecto como parámetro</td>
</tr>
</table>
</div>
</li>
<li>
<p>Imágenes de cada proyecto</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT I.id, I.name, P.name
FROM glance.images I JOIN keystone.project P ON I.owner = P.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Imágenes de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT I.id, I.name, P.name
FROM glance.images I JOIN keystone.project P ON I.owner = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY I.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar imágenes de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT CONCAT ('openstack image delete ', I.id)
FROM glance.images I JOIN keystone.project P ON I.owner = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY I.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Instances de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT I.uuid, I.hostname, P.name
FROM nova.instances I JOIN keystone.project P ON I.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY I.uuid
;</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar instancias de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT CONCAT ('openstack delete server ', I.uuid)
FROM nova.instances I JOIN keystone.project P ON I.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY I.uuid
;</code></pre>
</div>
</div>
</li>
<li>
<p>Attachements de volúmenes de instancias proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT A.instance_uuid, A.id, A.mountpoint, I.hostname
FROM cinder.volume_attachment A JOIN nova.instances I ON A.instance_uuid = I.uuid
WHERE A.instance_uuid IN (
SELECT I.uuid
FROM nova.instances I JOIN keystone.project P ON I.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy'))
) ORDER BY A.instance_uuid, A.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Dettach los volúmenes de las instancias de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT CONCAT ('openstack server remove volume ', A.instance_uuid, ' ', A.id)
FROM cinder.volume_attachment A JOIN nova.instances I ON A.instance_uuid = I.uuid
WHERE A.instance_uuid IN (
SELECT I.uuid
FROM nova.instances I JOIN keystone.project P ON I.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy'))
) ORDER BY A.instance_uuid, A.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Volúmenes de proyetos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT V.id, V.host, V.size, V.display_name
FROM cinder.volumes V JOIN keystone.project P ON V.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY V.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar volúmenes de proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT CONCAT ('openstack volume delete ', V.id)
FROM cinder.volumes V JOIN keystone.project P ON V.project_id = P.id
WHERE P.id IN (
SELECT id
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy')
) ORDER BY V.id;</code></pre>
</div>
</div>
</li>
<li>
<p>Proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT id, name
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy');</code></pre>
</div>
</div>
</li>
<li>
<p>Eliminar proyectos concretos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">SELECT CONCAT ('openstack project delete ' , id)
FROM keystone.project
WHERE name IN ('xxxx', 'yyyy');</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-01-17 23:27:01 CET
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>